<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buscador de Noticias</title>

    <!-- Preconexiones para proxies CORS - mejora velocidad -->
    <link rel="preconnect" href="https://api.allorigins.win">
    <link rel="preconnect" href="https://corsproxy.io">
    <link rel="dns-prefetch" href="https://api.codetabs.com">
    <link rel="dns-prefetch" href="https://thingproxy.freeboard.io">
    <link rel="dns-prefetch" href="https://cors-anywhere.herokuapp.com">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #4ecdc4, #44a08d);
            --white-transparent: rgba(255, 255, 255, 0.95);
            --shadow-light: 0 20px 40px rgba(0,0,0,0.1);
            --border-light: 1px solid rgba(255, 255, 255, 0.2);
            --transition: var(--transition);
            --radius: 20px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--primary-gradient);
            color: #2d3748;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 100%;
            margin: 0;
            padding: 20px 20px 20px 20px;
        }

        .header, .search-container, .news-item {
            background: var(--white-transparent);
            border-radius: var(--radius);
            box-shadow: var(--shadow-light);
            backdrop-filter: blur(10px);
            border: var(--border-light);
        }

        .header {
            text-align: center;
            margin-bottom: 8px;
            padding: 4px 14px;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 30%, #ffd700 70%, #ffed4e 100%);
        }

        .header h1 {
            color: #ffffff;
            margin-bottom: 5px;
            font-size: 2.5em;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            color: #f0f4ff;
            font-size: 1.1em;
            margin: 0;
            opacity: 0.95;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
        }

        .search-container {
            padding: 8px;
            margin: 0 auto 24px auto;
            width: fit-content;
            max-width: calc(100% - 6cm);
            background: linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%);
        }

        .search-box {
            display: flex;
            gap: 8px;
            margin-bottom: 0;
            align-items: center;
            flex-wrap: nowrap;
        }

        .sources-dropdown, .count-dropdown {
            position: relative;
        }

        .dropdown-select {
            padding: 8px 12px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: var(--transition);
            white-space: nowrap;
            height: 40px;
        }

        #sourcesSelect {
            background: var(--secondary-gradient);
            color: black;
            border: none;
            box-shadow: 0 8px 20px rgba(78, 205, 196, 0.3);
        }

        #sourcesSelect:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 25px rgba(78, 205, 196, 0.4);
        }

        #countSelect {
            background: white;
            color: black;
            border: 2px solid #e2e8f0;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        #countSelect:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15);
            background: #f7fafc;
            border-color: #cbd5e0;
        }

        #searchInput {
            flex: 0 1 32%;
            min-width: 200px;
            max-width: 420px;
            padding: 8px 12px;
            border: 2px solid rgba(102, 126, 234, 0.2);
            border-radius: 12px;
            font-size: 15px;
            transition: var(--transition);
            height: 38px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
        }

        #searchInput:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-1px);
        }

        .button-primary {
            padding: 8px 12px;
            background: var(--primary-gradient);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: var(--transition);
            height: 38px;
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.25);
        }

        .button-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 25px rgba(102, 126, 234, 0.4);
        }

        .button-primary:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }

        .reading-mode-container {
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 100px;
            flex-shrink: 0;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #cbd5e0, #a0aec0);
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        input:checked + .slider {
            background: var(--primary-gradient);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .switch-label {
            font-size: 12px;
            font-weight: 600;
            color: #4a5568;
            line-height: 1.2;
            text-align: center;
        }

        .loading {
            text-align: center;
            padding: 20px;
            font-size: 18px;
            color: #666;
            display: none;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #e74c3c;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 16px;
            margin-top: 20px;
            width: 100%;
        }

        .news-item {
            overflow: hidden;
            transition: var(--transition);
        }

        .news-item:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }

        .news-content {
            padding: 16px;
        }

        .news-source-time {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .news-source {
            background: var(--primary-gradient);
            color: white;
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .news-time {
            color: #666;
            font-size: 0.85em;
        }

        .news-title {
            margin-bottom: 8px;
        }

        .news-title h3 {
            color: #2c3e50;
            font-size: 0.95em;
            margin: 0;
            line-height: 1.4;
            font-weight: 600;
        }

        .news-title h3 a {
            text-decoration: none;
            color: inherit;
            transition: color 0.3s;
        }

        .news-title h3 a:hover {
            color: #e74c3c;
        }

        .news-subtitle {
            color: #666;
            font-size: 0.8em;
            line-height: 1.3;
            margin: 8px 0 0 0;
            display: -webkit-box;
            -webkit-line-clamp: 4;
            line-clamp: 4;
            -webkit-box-orient: vertical;
            overflow: hidden;
            height: calc(1.3em * 4);
            max-height: calc(1.3em * 4);
            cursor: pointer;
        }

        .news-subtitle a {
            text-decoration: none;
            color: inherit;
            display: block;
        }

        .news-subtitle a:hover {
            color: #333;
        }

        .message {
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
            display: none;
        }

        .error-message {
            background-color: #e74c3c;
            color: white;
        }

        .no-results {
            padding: 40px;
            color: #666;
            font-size: 1.1em;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 10000;
            display: none;
            opacity: 0;
            transition: var(--transition);
        }

        .modal-overlay.show {
            display: flex;
            opacity: 1;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-container {
            background: white;
            border-radius: var(--radius);
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            transform: scale(0.7);
            transition: var(--transition);
            position: relative;
        }

        .modal-overlay.show .modal-container {
            transform: scale(1);
        }

        .modal-header {
            padding: 15px 30px;
            border-bottom: 1px solid #e2e8f0;
            background: var(--primary-gradient);
            color: white;
            position: relative;
        }

        .modal-button {
            position: absolute;
            top: 15px;
            border-radius: 25px;
            padding: 8px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            font-weight: 600;
            transition: var(--transition);
            border: none;
        }

        .modal-close {
            right: 25px;
            background: #ff4757;
            box-shadow: 0 4px 12px rgba(255, 71, 87, 0.3);
        }

        .modal-close:hover {
            background: #ff3742;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(255, 71, 87, 0.4);
        }

        .modal-back {
            right: 25px;
            top: 60px;
            background: #28a745;
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
            display: none;
        }

        .modal-back:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(40, 167, 69, 0.4);
        }

        .modal-title {
            font-size: 1.4em;
            font-weight: 700;
            line-height: 1.3;
            margin: 0 80px 0 0;
            text-align: center;
        }

        .modal-meta {
            display: none;
        }

        .modal-body {
            padding: 0;
            overflow-y: auto;
            max-height: calc(90vh - 140px);
            padding-bottom: 50px;
        }

        .modal-loading {
            padding: 60px 30px;
            text-align: center;
            color: #666;
        }

        .modal-loading::after {
            content: '';
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 15px;
        }

        .modal-content {
            padding: 30px;
        }

        .modal-video-player {
            width: 100%;
            background: #000;
            border-radius: 12px;
            overflow: hidden;
            margin-top: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .modal-video-player iframe {
            width: 100%;
            height: 500px;
            border: none;
            display: block;
        }

        .modal-image {
            width: 100%;
            max-width: 100%;
            height: auto;
            border-radius: 12px;
            margin-top: 2px;
            margin-bottom: 8px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .modal-image-caption {
            font-size: 0.85em;
            color: #666;
            font-style: italic;
            text-align: center;
            margin-bottom: 20px;
            padding: 0 10px;
            line-height: 1.3;
        }

        .modal-text {
            margin-top: 30px;
            margin-bottom: 20px;
        }

        .modal-text * {
            font-family: inherit !important;
            font-size: inherit !important;
            line-height: inherit !important;
            color: inherit !important;
            font-weight: inherit !important;
            text-decoration: inherit !important;
        }

        .modal-text a {
            color: #2563eb !important;
            text-decoration: underline !important;
            font-weight: inherit !important;
            cursor: pointer !important;
        }

        .modal-text a:hover {
            color: #1d4ed8 !important;
            text-decoration: underline !important;
        }

        .modal-text p {
            margin-bottom: 16px !important;
            line-height: 1.6 !important;
        }

        .modal-text p:last-child {
            margin-bottom: 0 !important;
        }

        .modal-text .ev-title {
            font-size: 1.3em !important;
            font-weight: 700 !important;
            color: #1a202c !important;
            margin: 20px 0 12px 0 !important;
            line-height: 1.4 !important;
        }

        .modal-text .ev-main .ev-text .ev-title {
            font-size: 1.3em !important;
            font-weight: 700 !important;
        }

        .know-more-container {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background: #f8fafc;
        }

        .know-more-text {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-width: 0;
        }

        .know-more-image {
            flex: 0 0 45%;
            max-width: 45%;
        }

        .know-more-image img {
            width: 100%;
            height: auto;
            border-radius: 6px;
            object-fit: cover;
        }

        .know-more-title {
            font-weight: 600;
            color: #2563eb;
            text-decoration: none;
            font-size: 0.95em;
            line-height: 1.4;
        }

        .know-more-title:hover {
            color: #1d4ed8;
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            .know-more-container {
                flex-direction: column;
                gap: 12px;
            }

            .know-more-image {
                flex: none;
                max-width: 100%;
            }
        }

        .modal-text h2, .modal-text h3 {
            color: #1a202c;
            margin: 25px 0 15px;
            font-weight: 600;
        }

        .modal-text h2 {
            font-size: 1.3em;
        }

        .modal-text h3 {
            font-size: 1.15em;
        }

        .modal-text h2.article-text {
            font-size: 1.4em !important;
            font-weight: 700 !important;
            color: #1a202c !important;
            margin: 30px 0 20px 0 !important;
            line-height: 1.3 !important;
        }

        .modal-links {
            border-top: 1px solid #e2e8f0;
            padding: 20px 30px;
            background: #f8fafc;
        }

        .modal-links h4 {
            margin: 0 0 15px;
            color: #2d3748;
            font-size: 1em;
        }

        .modal-link-item {
            display: block;
            padding: 10px 15px;
            background: white;
            border-radius: 8px;
            margin-bottom: 8px;
            text-decoration: none;
            color: #4a5568;
            border: 1px solid #e2e8f0;
            transition: var(--transition);
        }

        .modal-link-item:hover {
            background: #667eea;
            color: white;
            transform: translateX(5px);
        }

        .modal-section {
            padding: 6px 12px;
            margin: -5px 10px 5px 10px;
            border-radius: 6px;
            border-left: 4px solid;
        }

        .modal-info-section {
            background: rgba(76, 175, 80, 0.08);
            border-color: #4CAF50;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
        }

        .modal-info-grid {
            display: flex;
            flex-direction: column;
            gap: 4px;
            flex: 1;
        }

        .modal-info-item {
            font-size: 0.85em;
            line-height: 1.3;
        }

        .modal-info-label {
            font-weight: 600;
            margin-right: 5px;
        }

        .modal-info-value {
            color: #388e3c;
        }

        .modal-info-value.author-link {
            color: #2e7d32;
            text-decoration: none;
        }

        .modal-info-value.author-link:hover {
            text-decoration: underline;
        }

        .modal-author-image {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #4CAF50;
            flex-shrink: 0;
        }

        .modal-summary-section {
            background: rgba(49, 130, 206, 0.08);
            padding: 12px 16px;
            margin: 5px 10px 25px 10px;
            border-left: 4px solid #3182ce;
            height: auto;
            display: block;
        }

        .modal-summary-label {
            font-weight: 600;
            color: #3182ce;
            margin-bottom: 6px;
            font-size: 0.85em;
        }

        .modal-summary-text {
            color: #2c5aa0;
            font-size: 0.9em;
            line-height: 1.4;
            font-style: normal;
            white-space: normal;
            word-wrap: break-word;
            overflow-wrap: break-word;
            max-width: 100%;
            overflow: visible;
            display: block;
            width: 100%;
        }

        .modal-summary-link {
            margin-top: 12px;
            font-size: 0.9em;
            padding: 8px 0;
            border-top: 1px solid rgba(49, 130, 206, 0.2);
        }

        .modal-summary-link a {
            color: #1e40af;
            text-decoration: underline;
            font-weight: 600;
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            background: rgba(30, 64, 175, 0.1);
        }

        .modal-summary-link a:hover {
            color: #1e3a8a;
            background: rgba(30, 64, 175, 0.2);
            transform: translateY(-1px);
        }

        .modal-error {
            padding: 40px 30px;
            text-align: center;
            color: #e53e3e;
        }

        .modal-footer {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--primary-gradient);
            padding: 10px 30px;
            border-top: 1px solid #e2e8f0;
        }

        .modal-original-link {
            display: block;
            width: 100%;
            padding: 8px 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            text-decoration: none;
            text-align: center;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.9em;
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .modal-original-link:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        /* Estilos para la secci贸n de tweets */
        .modal-tweets-section {
            margin: 25px 0;
            padding: 20px;
            background: linear-gradient(135deg, #e8f5fe 0%, #f0f8ff 100%);
            border-radius: 16px;
            border: 1px solid #d0e8f8;
        }

        .modal-tweets-section h4 {
            font-size: 1.2em;
            color: #1DA1F2;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 700;
        }

        .modal-tweet-card {
            background: #fff;
            border: 1px solid #e1e8ed;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: var(--transition);
        }

        .modal-tweet-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .tweet-embed-container {
            width: 100%;
            min-height: 600px;
            border-radius: 12px;
            overflow: hidden;
            background: #f7f9fa;
        }

        .tweet-embed-container iframe {
            width: 100%;
            min-height: 600px;
            border: none;
            border-radius: 12px;
        }

        @media (max-width: 768px) {
            .search-box {
                flex-direction: column;
                gap: 12px;
            }

            .reading-mode-container {
                justify-content: center;
                min-width: auto;
            }

            .results-container {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2em;
            }

            .news-content {
                padding: 12px;
            }

            .news-source-time {
                margin-bottom: 10px;
            }

            /* Centrar y mejorar franjas del modal en m贸vil */
            .modal-info-section {
                flex-direction: column;
                align-items: center;
                text-align: center;
                padding: 10px 15px;
            }

            .modal-info-grid {
                align-items: center;
                width: 100%;
            }

            .modal-info-item {
                text-align: center;
            }

            .modal-author-image {
                margin-top: 8px;
            }

            .modal-summary-section {
                text-align: center;
                padding: 15px 20px;
            }

            .modal-summary-label {
                text-align: center;
                display: block;
            }

            .modal-summary-text {
                text-align: center;
            }

            .news-title h3 {
                font-size: 1em;
            }

            .modal-overlay {
                padding: 10px;
            }

            .modal-container {
                max-height: 95vh;
            }

            .modal-header {
                padding: 12px 25px;
            }

            .modal-title {
                font-size: 1.2em;
                margin-right: 70px;
            }

            .modal-button {
                top: 10px;
                padding: 6px 12px;
                font-size: 12px;
            }

            .modal-close {
                right: 20px;
            }

            .modal-back {
                right: 20px;
                top: 50px;
            }

            .modal-content {
                padding: 20px;
            }

            .modal-text {
                font-size: 1em;
            }

            .modal-footer {
                padding: 8px 20px;
            }

            .modal-original-link {
                padding: 6px 15px;
                font-size: 0.85em;
            }

            .modal-section {
                margin: -5px 5px 5px 5px;
                padding: 5px 10px;
            }

            .modal-info-grid {
                gap: 5px;
            }

            .modal-summary-section {
                margin: 5px 5px 20px 5px;
                padding: 10px 12px;
            }

            .modal-video-player iframe {
                height: 300px;
            }

            .modal-tweets-section {
                margin: 15px 0;
                padding: 15px;
            }

            .modal-tweet-card {
                padding: 12px;
            }

            .tweet-embed-container {
                min-height: 500px;
            }

            .tweet-embed-container iframe {
                min-height: 500px;
            }
        }

        @media (max-width: 480px) {
            .results-container {
                gap: 12px;
            }

            .news-content {
                padding: 10px;
            }

            .news-source {
                font-size: 0.7em;
                padding: 3px 6px;
            }

            .news-time {
                font-size: 0.8em;
            }

            .news-title h3 {
                font-size: 0.95em;
            }

            .news-subtitle {
                font-size: 0.85em !important;
                display: block !important;
                margin-top: 8px !important;
                line-height: 1.4 !important;
                visibility: visible !important;
                opacity: 1 !important;
                height: auto !important;
                max-height: none !important;
                overflow: visible !important;
                color: #666 !important;
            }

            .modal-tweets-section {
                margin: 10px 0;
                padding: 10px;
            }

            .modal-tweets-section h4 {
                font-size: 1em;
            }

            .modal-tweet-card {
                padding: 10px;
                margin-bottom: 12px;
            }

            .tweet-embed-container {
                min-height: 450px;
            }

            .tweet-embed-container iframe {
                min-height: 450px;
            }
        }

        /* Bot贸n de peri贸dicos configurados */
        .newspapers-button {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 9999;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 50%;
            padding: 12px;
            font-size: 20px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 48px;
            height: 48px;
        }

        .newspapers-button:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }

        .newspapers-dropdown {
            position: fixed;
            top: 70px;
            left: 20px;
            z-index: 9998;
            background: white;
            border-radius: 12px;
            padding: 12px;
            min-width: 280px;
            max-width: 350px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            display: none;
            opacity: 0;
            transform: translateY(-10px);
            transition: var(--transition);
        }

        .newspapers-dropdown.show {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        .newspapers-dropdown__header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            padding-bottom: 6px;
            border-bottom: 2px solid #e2e8f0;
        }

        .newspapers-dropdown__title {
            font-size: 16px;
            font-weight: 700;
            color: #1a202c;
            margin: 0;
        }

        .newspapers-dropdown__export-btn {
            background: linear-gradient(135deg, #48bb78, #38a169);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 6px 12px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px rgba(72, 187, 120, 0.3);
        }

        .newspapers-dropdown__export-btn:hover {
            background: linear-gradient(135deg, #38a169, #2f855a);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(72, 187, 120, 0.4);
        }

        .newspapers-dropdown__export-btn:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            box-shadow: none;
        }

        .newspapers-dropdown__list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .newspapers-dropdown__item {
            padding: 2px 8px;
            margin-bottom: 0;
            border-radius: 4px;
            transition: all 0.2s ease;
            font-size: 13px;
            color: #2d3748;
            cursor: pointer;
            border: 1px solid transparent;
            line-height: 1.4;
        }

        .newspapers-dropdown__item:hover {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border-color: #667eea;
            transform: translateX(5px);
        }

        .newspapers-dropdown__text {
            font-weight: 600;
        }

        .newspapers-dropdown__domain {
            color: #718096;
            font-size: 11px;
            margin-left: 4px;
        }

        @media (max-width: 768px) {
            .newspapers-button {
                top: 10px;
                left: 10px;
                width: 40px;
                height: 40px;
                padding: 10px;
                font-size: 18px;
            }

            .newspapers-dropdown {
                top: 60px;
                left: 10px;
                min-width: 250px;
            }
        }
    </style>
</head>
<body>
    <!-- Bot贸n de peri贸dicos configurados -->
    <button class="newspapers-button" id="newspapersButton"></button>

    <!-- Desplegable de peri贸dicos -->
    <div class="newspapers-dropdown" id="newspapersDropdown">
        <div class="newspapers-dropdown__header">
            <div class="newspapers-dropdown__title">Peri贸dicos (67)</div>
            <button class="newspapers-dropdown__export-btn" id="exportNewspapersBtn">Exportar</button>
        </div>
        <ul class="newspapers-dropdown__list" id="newspapersList">
            <li class="newspapers-dropdown__item" data-domain="abc.es">
                <span class="newspapers-dropdown__text">ABC</span>
                <span class="newspapers-dropdown__domain">(abc.es)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="antena3.com">
                <span class="newspapers-dropdown__text">Antena 3</span>
                <span class="newspapers-dropdown__domain">(antena3.com)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="es.ara.cat">
                <span class="newspapers-dropdown__text">ARA</span>
                <span class="newspapers-dropdown__domain">(es.ara.cat)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="cadenaser.com">
                <span class="newspapers-dropdown__text">Cadena SER</span>
                <span class="newspapers-dropdown__domain">(cadenaser.com)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="catalunyapress.es">
                <span class="newspapers-dropdown__text">CATALUNYAPRESS.ES</span>
                <span class="newspapers-dropdown__domain">(catalunyapress.es)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="cope.es">
                <span class="newspapers-dropdown__text">Cope.es</span>
                <span class="newspapers-dropdown__domain">(cope.es)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="cuadernosdeseguridad.com">
                <span class="newspapers-dropdown__text">CUADERNOSDESEGURIDAD.COM</span>
                <span class="newspapers-dropdown__domain">(cuadernosdeseguridad.com)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="deia.eus">
                <span class="newspapers-dropdown__text">Deia.eus</span>
                <span class="newspapers-dropdown__domain">(deia.eus)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="democrata.es">
                <span class="newspapers-dropdown__text">Dem贸crata</span>
                <span class="newspapers-dropdown__domain">(democrata.es)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="diariodemallorca.es">
                <span class="newspapers-dropdown__text">DIARIODEMALLORCA.ES</span>
                <span class="newspapers-dropdown__domain">(diariodemallorca.es)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="diariosocialista.net">
                <span class="newspapers-dropdown__text">DIARIOSOCIALISTA.NET</span>
                <span class="newspapers-dropdown__domain">(diariosocialista.net)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="diariosur.es">
                <span class="newspapers-dropdown__text">DIARIOSUR.ES</span>
                <span class="newspapers-dropdown__domain">(diariosur.es)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="diariosigloxxi.com">
                <span class="newspapers-dropdown__text">Diariosigloxxi.com</span>
                <span class="newspapers-dropdown__domain">(diariosigloxxi.com)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="elconfidencial.com">
                <span class="newspapers-dropdown__text">EL CONFIDENCIAL</span>
                <span class="newspapers-dropdown__domain">(elconfidencial.com)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="elconfidencialdigital.com">
                <span class="newspapers-dropdown__text">ELCONFIDENCIALDIGITAL.COM</span>
                <span class="newspapers-dropdown__domain">(elconfidencialdigital.com)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="elcorreo.com">
                <span class="newspapers-dropdown__text">ELCORREO.COM</span>
                <span class="newspapers-dropdown__domain">(elcorreo.com)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="eldebate.com">
                <span class="newspapers-dropdown__text">elDEBATE</span>
                <span class="newspapers-dropdown__domain">(eldebate.com)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="eldia.es">
                <span class="newspapers-dropdown__text">ELDIA.ES</span>
                <span class="newspapers-dropdown__domain">(eldia.es)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="eldiario.es">
                <span class="newspapers-dropdown__text">Eldiario.es</span>
                <span class="newspapers-dropdown__domain">(eldiario.es)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="eldiariodemadrid.es">
                <span class="newspapers-dropdown__text">Eldiariodemadrid.es</span>
                <span class="newspapers-dropdown__domain">(eldiariodemadrid.es)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="elespanol.com">
                <span class="newspapers-dropdown__text">El Espa帽ol</span>
                <span class="newspapers-dropdown__domain">(elespanol.com)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="elglobalfarma.com">
                <span class="newspapers-dropdown__text">ELGLOBALFARMA.COM</span>
                <span class="newspapers-dropdown__domain">(elglobalfarma.com)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="huffingtonpost.es">
                <span class="newspapers-dropdown__text">El HuffPost</span>
                <span class="newspapers-dropdown__domain">(huffingtonpost.es)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="elindependiente.com">
                <span class="newspapers-dropdown__text">El Independiente</span>
                <span class="newspapers-dropdown__domain">(elindependiente.com)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="elmundo.es">
                <span class="newspapers-dropdown__text">El Mundo</span>
                <span class="newspapers-dropdown__domain">(elmundo.es)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="elmundotoday.com">
                <span class="newspapers-dropdown__text">ELMUNDOTODAY.COM</span>
                <span class="newspapers-dropdown__domain">(elmundotoday.com)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="elnoticierodigital.com">
                <span class="newspapers-dropdown__text">ELNOTICIERODIGITAL.COM</span>
                <span class="newspapers-dropdown__domain">(elnoticierodigital.com)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="elpais.com">
                <span class="newspapers-dropdown__text">El Pa铆s</span>
                <span class="newspapers-dropdown__domain">(elpais.com)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="elperiodico.com">
                <span class="newspapers-dropdown__text">El Peri贸dico</span>
                <span class="newspapers-dropdown__domain">(elperiodico.com)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="eltelevisero.huffingtonpost.es">
                <span class="newspapers-dropdown__text">ELTELEVISERO.HUFFINGTONPOST.ES</span>
                <span class="newspapers-dropdown__domain">(eltelevisero.huffingtonpost.es)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="epe.es">
                <span class="newspapers-dropdown__text">Epe.es</span>
                <span class="newspapers-dropdown__domain">(epe.es)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="escudodigital.com">
                <span class="newspapers-dropdown__text">ESCUDODIGITAL.COM</span>
                <span class="newspapers-dropdown__domain">(escudodigital.com)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="estrelladigital.es">
                <span class="newspapers-dropdown__text">ESTRELLADIGITAL.ES</span>
                <span class="newspapers-dropdown__domain">(estrelladigital.es)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="eurocarne.com">
                <span class="newspapers-dropdown__text">EUROCARNE.COM</span>
                <span class="newspapers-dropdown__domain">(eurocarne.com)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="europapress.es">
                <span class="newspapers-dropdown__text">Europa Press</span>
                <span class="newspapers-dropdown__domain">(europapress.es)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="gacetamedica.com">
                <span class="newspapers-dropdown__text">GACETAMEDICA.COM</span>
                <span class="newspapers-dropdown__domain">(gacetamedica.com)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="gacetinmadrid.com">
                <span class="newspapers-dropdown__text">Gacetinmadrid.com</span>
                <span class="newspapers-dropdown__domain">(gacetinmadrid.com)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="hoyaragon.es">
                <span class="newspapers-dropdown__text">HOYARAGON.ES</span>
                <span class="newspapers-dropdown__domain">(hoyaragon.es)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="infoplay.info">
                <span class="newspapers-dropdown__text">INFOPLAY.INFO</span>
                <span class="newspapers-dropdown__domain">(infoplay.info)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="infobae.com">
                <span class="newspapers-dropdown__text">INFOBAE.COM</span>
                <span class="newspapers-dropdown__domain">(infobae.com)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="infolibre.es">
                <span class="newspapers-dropdown__text">INFOLIBRE</span>
                <span class="newspapers-dropdown__domain">(infolibre.es)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="insst.es">
                <span class="newspapers-dropdown__text">INSST.ES</span>
                <span class="newspapers-dropdown__domain">(insst.es)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="interempresas.net">
                <span class="newspapers-dropdown__text">INTEREMPRESAS.NET</span>
                <span class="newspapers-dropdown__domain">(interempresas.net)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="joanseguidor.com">
                <span class="newspapers-dropdown__text">Joan Seguidor</span>
                <span class="newspapers-dropdown__domain">(joanseguidor.com)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="lamoncloa.gob.es">
                <span class="newspapers-dropdown__text">LAMONCLOA.GOB.ES</span>
                <span class="newspapers-dropdown__domain">(lamoncloa.gob.es)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="laopiniondezamora.es">
                <span class="newspapers-dropdown__text">LAOPINIONDEZAMORA.ES</span>
                <span class="newspapers-dropdown__domain">(laopiniondezamora.es)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="larazon.es">
                <span class="newspapers-dropdown__text">LA RAZN</span>
                <span class="newspapers-dropdown__domain">(larazon.es)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="lasexta.com">
                <span class="newspapers-dropdown__text">laSexta</span>
                <span class="newspapers-dropdown__domain">(lasexta.com)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="lavanguardia.com">
                <span class="newspapers-dropdown__text">La Vanguardia</span>
                <span class="newspapers-dropdown__domain">(lavanguardia.com)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="libertaddigital.com">
                <span class="newspapers-dropdown__text">LIBERTAD DIGITAL</span>
                <span class="newspapers-dropdown__domain">(libertaddigital.com)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="maspalomas24h.com">
                <span class="newspapers-dropdown__text">MASPALOMAS24H.COM</span>
                <span class="newspapers-dropdown__domain">(maspalomas24h.com)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="naiz.eus">
                <span class="newspapers-dropdown__text">Naiz</span>
                <span class="newspapers-dropdown__domain">(naiz.eus)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="newtral.es">
                <span class="newspapers-dropdown__text">Newtral.es</span>
                <span class="newspapers-dropdown__domain">(newtral.es)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="noteolvidesdelsaharaoccidental.org">
                <span class="newspapers-dropdown__text">NOTEOLVIDESDELSAHARAOCCIDENTAL.ORG</span>
                <span class="newspapers-dropdown__domain">(noteolvidesdelsaharaoccidental.org)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="nuevatribuna.es">
                <span class="newspapers-dropdown__text">NUEVATRIBUNA.ES</span>
                <span class="newspapers-dropdown__domain">(nuevatribuna.es)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="ondacero.es">
                <span class="newspapers-dropdown__text">ONDACERO.ES</span>
                <span class="newspapers-dropdown__domain">(ondacero.es)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="okdiario.com">
                <span class="newspapers-dropdown__text">OKDIARIO</span>
                <span class="newspapers-dropdown__domain">(okdiario.com)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="pressdigital.es">
                <span class="newspapers-dropdown__text">PRESSDIGITAL.ES</span>
                <span class="newspapers-dropdown__domain">(pressdigital.es)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="publico.es">
                <span class="newspapers-dropdown__text">P煤blico</span>
                <span class="newspapers-dropdown__domain">(publico.es)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="puertollano.es">
                <span class="newspapers-dropdown__text">PUERTOLLANO.ES</span>
                <span class="newspapers-dropdown__domain">(puertollano.es)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="radiopopular.com">
                <span class="newspapers-dropdown__text">Radiopopular.com</span>
                <span class="newspapers-dropdown__domain">(radiopopular.com)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="rtve.es">
                <span class="newspapers-dropdown__text">RTVE</span>
                <span class="newspapers-dropdown__domain">(rtve.es)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="salamancartvaldia.es">
                <span class="newspapers-dropdown__text">SALAMANCARTVALDIA.ES</span>
                <span class="newspapers-dropdown__domain">(salamancartvaldia.es)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="telecinco.es">
                <span class="newspapers-dropdown__text">Telecinco</span>
                <span class="newspapers-dropdown__domain">(telecinco.es)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="telemadrid.es">
                <span class="newspapers-dropdown__text">Telemadrid.es</span>
                <span class="newspapers-dropdown__domain">(telemadrid.es)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="teleprensa.com">
                <span class="newspapers-dropdown__text">Teleprensa</span>
                <span class="newspapers-dropdown__domain">(teleprensa.com)</span>
            </li>
            <li class="newspapers-dropdown__item" data-domain="valenciaplaza.com">
                <span class="newspapers-dropdown__text">VALENCIAPLAZA.COM</span>
                <span class="newspapers-dropdown__domain">(valenciaplaza.com)</span>
            </li>
        </ul>
    </div>

    <div class="container">
        <div class="header">
            <h1> Buscador de noticias</h1>
        </div>

        <div class="search-container">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Escribe tu t茅rmino de b煤squeda (ej: ayuso, pedro s谩nchez, etc.)" />
                <button id="searchButton" class="button-primary">Buscar</button>
                <div class="count-dropdown">
                    <select id="countSelect" class="dropdown-select">
                        <option value="25">25 noticias</option>
                        <option value="50">50 noticias</option>
                        <option value="100">100 noticias</option>
                    </select>
                </div>
                <div class="sources-dropdown">
                    <select id="sourcesSelect" class="dropdown-select">
                        <option value="all">Todos los peri贸dicos</option>
                    </select>
                </div>
                <div class="reading-mode-container">
                    <span class="switch-label">Ventana<br>emergente</span>
                    <label class="switch">
                        <input type="checkbox" id="readingModeSwitch" checked>
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
        </div>

        <div class="loading" id="loading">
            Buscando noticias...
        </div>

        <div class="message error-message" id="errorMessage">
            Error al buscar noticias. Por favor, int茅ntalo de nuevo.
        </div>

        <div class="message no-results" id="noResults">
            No se encontraron noticias para tu b煤squeda.
        </div>

        <div class="results-container" id="resultsContainer">
        </div>
    </div>

    <!-- Modal para mostrar contenido completo -->
    <div class="modal-overlay" id="newsModal">
        <div class="modal-container">
            <div class="modal-header">
                <button class="modal-button modal-back" id="modalBack">Volver</button>
                <button class="modal-button modal-close">Cerrar</button>
                <h2 class="modal-title" id="modalTitle">Cargando...</h2>
                <div class="modal-meta">
                    <div class="modal-source" id="modalSource"></div>
                    <div class="modal-author" id="modalAuthor"></div>
                    <div class="modal-dates" id="modalDates"></div>
                </div>
            </div>
             <div class="modal-body" id="modalBody">
                 <div class="modal-loading">
                     Cargando contenido completo...
                 </div>
             </div>
             <div class="modal-footer">
                 <a href="#" class="modal-original-link" id="modalOriginalLink" target="_blank">
                      Abrir la noticia original
                 </a>
             </div>
         </div>
     </div>

    <script>
        // ===== DETECCIN DE DISPOSITIVO Y NAVEGADOR =====
        function esMovil() {
            const userAgent = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            const pantallaPeque帽a = window.innerWidth <= 768;
            const tieneTouch = 'ontouchstart' in window;
            return userAgent || (pantallaPeque帽a && tieneTouch);
        }

        function detectarSistemaOperativo() {
            const userAgent = navigator.userAgent.toLowerCase();
            
            // Android y iOS deben ir primero porque tambi茅n pueden contener "linux" o "mac"
            if (userAgent.includes('android')) return 'Android';
            if (userAgent.includes('iphone') || userAgent.includes('ipad')) return 'iOS';
            if (userAgent.includes('win')) return 'Windows';
            if (userAgent.includes('mac')) return 'MacOS';
            if (userAgent.includes('linux')) return 'Linux';
            
            return 'Desconocido';
        }

        function detectarNavegador() {
            const userAgent = navigator.userAgent;
            
            // Navegadores espec铆ficos primero (antes de Chrome, ya que usan Chromium)
            if (userAgent.includes('Jkfk')) return 'Soul Browser';
            if (userAgent.includes('Brave') || userAgent.includes('brave')) return 'Brave';
            if (userAgent.includes('SamsungBrowser')) return 'Samsung Internet';
            if (userAgent.includes('UCBrowser') || userAgent.includes('UCWeb')) return 'UC Browser';
            if (userAgent.includes('Vivaldi')) return 'Vivaldi';
            if (userAgent.includes('Edg')) return 'Edge';
            if (userAgent.includes('Opera') || userAgent.includes('OPR')) return 'Opera';
            
            // Navegadores principales
            if (userAgent.includes('Firefox')) return 'Firefox';
            if (userAgent.includes('Chrome')) return 'Chrome';
            if (userAgent.includes('Safari')) return 'Safari';
            if (userAgent.includes('Trident')) return 'Internet Explorer';
            
            return 'Navegador basado en Chromium';
        }

        function obtenerInfoDispositivo() {
            const sistema = detectarSistemaOperativo();
            const navegador = detectarNavegador();
            const tipoDispositivo = esMovil() ? 'M贸vil' : 'Ordenador';
            const resolucion = window.screen.width + ' x ' + window.screen.height;
            const idioma = navigator.language;
            
            return {
                sistema,
                navegador,
                tipoDispositivo,
                resolucion,
                idioma
            };
        }

        // Mostrar informaci贸n al cargar la p谩gina
        window.addEventListener('DOMContentLoaded', function() {
            const info = obtenerInfoDispositivo();
            
            // Crear un div flotante con la informaci贸n
            const infoDiv = document.createElement('div');
            infoDiv.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                padding: 20px;
                border-radius: 15px;
                box-shadow: 0 10px 40px rgba(0,0,0,0.3);
                z-index: 99999;
                max-width: 90%;
                max-height: 80%;
                overflow-y: auto;
            `;
            
            infoDiv.innerHTML = `
                <h3 style="margin: 0 0 15px 0; color: #667eea;"> Informaci贸n del Dispositivo</h3>
                <p><strong>ワ Tipo:</strong> ${info.tipoDispositivo}</p>
                <p><strong> Sistema:</strong> ${info.sistema}</p>
                <p><strong> Navegador:</strong> ${info.navegador}</p>
                <p><strong> Resoluci贸n:</strong> ${info.resolucion}</p>
                <p><strong>ｏ Idioma:</strong> ${info.idioma}</p>
                <p style="margin-top: 15px;"><strong> UserAgent (copia esto):</strong></p>
                <textarea readonly style="
                    width: 100%;
                    height: 100px;
                    padding: 10px;
                    border: 1px solid #ddd;
                    border-radius: 5px;
                    font-size: 12px;
                    font-family: monospace;"
                >${navigator.userAgent}</textarea>
                <button id="closeInfoBtn" style="
                    margin-top: 15px;
                    padding: 10px 20px;
                    background: #667eea;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    cursor: pointer;
                    width: 100%;"
                >Cerrar</button>
            `;
            
            document.body.appendChild(infoDiv);
            
            // Cerrar al hacer clic en el bot贸n
            document.getElementById('closeInfoBtn').addEventListener('click', function() {
                infoDiv.remove();
            });
            
            // Auto-seleccionar el textarea al hacer clic
            infoDiv.querySelector('textarea').addEventListener('click', function() {
                this.select();
            });
        });
        // ===== FIN DETECCIN =====

        class NewsSearcher {
            constructor() {
                this.elements = {
                    searchInput: document.getElementById('searchInput'),
                    searchButton: document.getElementById('searchButton'),
                    countSelect: document.getElementById('countSelect'),
                    sourcesSelect: document.getElementById('sourcesSelect'),
                    readingModeSwitch: document.getElementById('readingModeSwitch'),
                    loading: document.getElementById('loading'),
                    errorMessage: document.getElementById('errorMessage'),
                    noResults: document.getElementById('noResults'),
                    resultsContainer: document.getElementById('resultsContainer'),
                    modal: document.getElementById('newsModal'),
                    modalTitle: document.getElementById('modalTitle'),
                    modalBody: document.getElementById('modalBody'),
                    modalOriginalLink: document.getElementById('modalOriginalLink'),
                    modalBack: document.getElementById('modalBack'),
                    modalClose: document.querySelector('.modal-close')
                };

                this.currentQuery = '';
                this.allNews = [];
                this.newsCounts = {};
                this.modalHistory = [];
                this.currentOriginalUrl = '';
                this.currentSubtitle = '';

                this.proxies = [
                    'https://api.allorigins.win/raw?url=',
                    'https://corsproxy.io/?',
                    'https://api.codetabs.com/v1/proxy?quest=',
                    'https://cors-anywhere.herokuapp.com/'
                ];

                this.newspaperToDomain = {
                    'elpais': 'elpais.com',
                    'elmundo': 'elmundo.es',
                    'abc': 'abc.es',
                    'lavanguardia': 'lavanguardia.com',
                    'elperiodico': 'elperiodico.com',
                    'elconfidencial': 'elconfidencial.com',
                    'publico': 'publico.es',
                    'infolibre': 'infolibre.es',
                    'infobae': 'infobae.com',
                    'diariosur': 'diariosur.es',
                    'salamancartvaldia': 'salamancartvaldia.es',
                    'eldiario.es': 'eldiario.es',
                    'lasexta': 'lasexta.com',
                    'antena3': 'antena3.com',
                    'rtve': 'rtve.es',
                    'europapress': 'europapress.es',
                    'efe': 'efe.com',
                    '20minutos': '20minutos.es',
                    'elhuffpost': 'huffingtonpost.es',
                    'elespanol': 'elespanol.com',
                    'larazon': 'larazon.es',
                    'marca': 'marca.com',
                    'diarioas': 'as.com',
                    'sport': 'sport.es',
                    'mundodeportivo': 'mundodeportivo.com',
                    'okdiario': 'okdiario.com',
                    'libertaddigital': 'libertaddigital.com',
                    'elplural': 'elplural.com',
                    'vozpopuli': 'vozpopuli.com',
                    'expansion': 'expansion.com',
                    'cincodias': 'cincodias.com',
                    'eleconomista': 'eleconomista.es'
                };

                this.nameToValue = {
                    'EL PAS': 'elpais',
                    'El Mundo': 'elmundo',
                    'ABC': 'abc',
                    'La Vanguardia': 'lavanguardia',
                    'El Peri贸dico': 'elperiodico',
                    'El Confidencial': 'elconfidencial',
                    'P煤blico': 'publico',
                    'InfoLibre': 'infolibre',
                    'INFOBAE.COM': 'infobae',
                    'INFOLIBRE': 'infolibre',
                    'DIARIOSUR.ES': 'diariosur',
                    'SALAMANCARTVALDIA.ES': 'salamancartvaldia',
                    'eldiario.es': 'eldiario.es',
                    'laSexta': 'lasexta',
                    'Antena 3': 'antena3',
                    'RTVE': 'rtve',
                    'Europa Press': 'europapress',
                    'EFE': 'efe',
                    '20 Minutos': '20minutos',
                    'El HuffPost': 'elhuffpost',
                    'El Espa帽ol': 'elespanol',
                    'La Raz贸n': 'larazon',
                    'MARCA': 'marca',
                    'Diario AS': 'diarioas',
                    'Sport': 'sport',
                    'Mundo Deportivo': 'mundodeportivo',
                    'OKDiario': 'okdiario',
                    'OKDIARIO': 'okdiario',
                    'Libertad Digital': 'libertaddigital',
                    'El Plural': 'elplural',
                    'Vozp贸puli': 'vozpopuli',
                    'Expansi贸n': 'expansion',
                    'Cinco D铆as': 'cincodias',
                    'El Economista': 'eleconomista'
                };

                this.knownSources = {
                    'elpais.com': 'EL PAS',
                    'elmundo.es': 'El Mundo',
                    'abc.es': 'ABC',
                    'lavanguardia.com': 'La Vanguardia',
                    'elperiodico.com': 'El Peri贸dico',
                    'elconfidencial.com': 'El Confidencial',
                    'publico.es': 'P煤blico',
                    'infolibre.es': 'INFOLIBRE',
                    'infobae.com': 'INFOBAE.COM',
                    'diariosur.es': 'DIARIOSUR.ES',
                    'salamancartvaldia.es': 'SALAMANCARTVALDIA.ES',
                    'eldiario.es': 'eldiario.es',
                    'lasexta.com': 'laSexta',
                    'antena3.com': 'Antena 3',
                    'rtve.es': 'RTVE',
                    'europapress.es': 'Europa Press',
                    'efe.com': 'EFE',
                    '20minutos.es': '20 Minutos',
                    'huffingtonpost.es': 'El HuffPost',
                    'elespanol.com': 'El Espa帽ol',
                    'larazon.es': 'La Raz贸n',
                    'marca.com': 'MARCA',
                    'as.com': 'Diario AS',
                    'sport.es': 'Sport',
                    'mundodeportivo.com': 'Mundo Deportivo',
                    'okdiario.com': 'OKDIARIO',
                    'libertaddigital.com': 'Libertad Digital',
                    'elplural.com': 'El Plural',
                    'vozpopuli.com': 'Vozp贸puli',
                    'expansion.com': 'Expansi贸n',
                    'cincodias.com': 'Cinco D铆as',
                    'eleconomista.es': 'El Economista'
                };

                // =====================================================================
                // CONFIGURACIN DE SELECTORES CSS POR PERIDICO
                // =====================================================================
                // Aqu铆 se definen los selectores CSS espec铆ficos para extraer contenido
                // de cada peri贸dico. Cada configuraci贸n incluye:
                // - title: selector para el t铆tulo de la noticia
                // - content: selector para el contenido principal del art铆culo
                // - author: selector para el nombre del autor
                // - images: selectores para las im谩genes del art铆culo
                // - date: selector para la fecha de publicaci贸n
                // - exclude: selectores de elementos a eliminar (ads, comentarios, etc.)
                // =====================================================================

                this.siteConfigs = {
                    // -----------------------------------------------------------------
                    // ELDIARIO.ES
                    // -----------------------------------------------------------------
                    'eldiario.es': {
                        title: [
                            'main.content__wrapper .c-header .news-header h1.title',
                            '.content__wrapper .c-header .news-header h1.title',
                            '.c-header .news-header h1.title',
                            '.news-header h1.title',
                            'h1.title',
                            'h1'
                        ].join(', '),
                        content: '.partner-wrapper.article-page__body-row .second-col, .article-text, .content__wrapper, .item__content, .c-content',
                        author: '.author, .authors, .item__content__author',
                        images: [
                            '.ni-figure img',
                            '.news-image img',
                            '.news-image amp-img',
                            '.main-image img',
                            '.lazy img',
                            '.know-more__img img',
                            '.post-item__body picture img'
                        ].join(', '),
                        date: '.date, .modification-date',
                        exclude: [
                            '.first-col',
                            '.edi-advertising',
                            '.ad-body',
                            '.ad__no-dotted',
                            '.ad__no-legend',
                            '.ad-mobile-intext',
                            '.ad-desktop-intext',
                            '.ad-desktop-intext--300x600',
                            '.addoor-widget',
                            '.edi-advertising--header',
                            '.header-ad',
                            '.edi-advertising-sticky-wrapper',
                            '.fixedadmobile',
                            '.bannerbottom',
                            '.edi-social-buttons',
                            '.shareIcons',
                            '.comments',
                            '.date-comments-wrapper',
                            '.recirculation-area',
                            '.header',
                            '.menu-header',
                            '.c-subheader'
                        ].join(', ')
                    },

                    // -----------------------------------------------------------------
                    // EL PAS
                    // -----------------------------------------------------------------
                    'elpais.com': {
                        title: 'h1, h1.headline, .a_t, .titulo, .title',
                        content: '.a_c, .a, .a_md, .stream-panel-content, .ev-text, article',
                        author: '.a_md_a_n, .ev-author, .autor, .a_md_a',
                        images: [
                            '.a_e_m img',
                            '.a_e_m amp-img',
                            'figure.a_m img',
                            'figure.a_m amp-img',
                            '.a_m_w img',
                            '.a_m_w amp-img',
                            '.a_m_i img',
                            '.a_m_i amp-img',
                            '.a_c img',
                            '.a_c amp-img',
                            '.prisa_ad figure.a_m img',
                            '.prisa_ad figure.a_m amp-img',
                            '.prisa_ad .a_m_w img',
                            '.prisa_ad .a_m_w amp-img',
                            '.ep_i',
                            '.ev-au-img'
                        ].join(', '),
                        date: '.ev-date, .a_md_f, time',
                        exclude: [
                            '.ad',
                            '.ad-giga',
                            '.ad-ldb',
                            '.ad-mldb',
                            '.ad-mpu',
                            '.ad-nstd-bd',
                            '#ctn_head',
                            '#edition_head',
                            '#reading_progress_bar_id',
                            '#capping-upgrade',
                            '#disqus_thread',
                            '#comments_bar',
                            '#comments_container',
                            '#comments_close',
                            '.disqus-comment-count',
                            '.w_rs',
                            '.a_com',
                            '.me-dis',
                            '.me_f',
                            '.w-rel',
                            '.outbrain',
                            '.obne_ob',
                            '.obne_ne',
                            '.taboola',
                            '#taboola-below-article-thumbnails',
                            '.x-ph',
                            '.x_bh',
                            '.z-fo',
                            '.z-he'
                        ].join(', ')
                    },

                    // -----------------------------------------------------------------
                    // EL MUNDO
                    // -----------------------------------------------------------------
                    'elmundo.es': {
                        title: [
                            '.ue-c-article__headline',
                            'h1.ue-c-article__headline',
                            'h1'
                        ].join(', '),
                        subtitle: '.ue-c-article__standfirst',
                        content: '.ue-c-article__body, .article-text',
                        author: [
                            '.ue-c-article__author-name-item',
                            '.ue-c-article__author-name',
                            '.ue-c-article__byline-name'
                        ].join(', '),
                        images: [
                            '.ue-c-article__image',
                            '.ue-c-article__media img',
                            '.ue-c-article__image img'
                        ].join(', '),
                        imageCaption: [
                            '.ue-c-article__media-caption',
                            '.ue-c-article__media-description'
                        ].join(', '),
                        date: [
                            '.ue-c-article__publishdate',
                            'time[datetime]',
                            '.ue-c-article__bar-footer time'
                        ].join(', '),
                        exclude: [
                            // Header y navegaci贸n
                            '.ue-c-main-header',
                            '.ue-l-main-header__row',
                            '.ue-c-main-navigation',
                            '.ue-c-main-header__breadcrumb',
                            '.ue-c-main-header__subscription',
                            '.ue-c-section-title',
                            // Publicidad
                            '.ue-c-ad',
                            '.ue-gcp-sd',
                            '.ue-gcp-si',
                            '.ue-gcp-m',
                            '.ue-gcp-r',
                            '.ue-gcp-rb',
                            '.ue-gcp-rc',
                            '.ue-gcp-f',
                            '.ue-gcp-f2',
                            '.ue-gcp-f3',
                            '.ue-gcp-r-nata',
                            '.skin-ad',
                            '[id*="div-gpt-ad"]',
                            '.publicidad',
                            // Compartir y redes sociales
                            '.ue-c-article__share-tools',
                            '.ue-c-article__toolbox',
                            '.ue-c-main-header__social-tools',
                            // Comentarios
                            '.aside-comments',
                            '.comments-panel',
                            '.comments-tool',
                            '.em-comments-container-body',
                            '.ue-c-article__button--theme-comments',
                            '#ancla_comentarios',
                            // Widgets y m贸dulos externos
                            '.ue-c-popular-links',
                            '.ue-l-article__newsletter-widget',
                            '[id*="taboola"]',
                            // Footer
                            '.site-footer',
                            '.container-list-footer',
                            // Paywall
                            '.ue-cintillo-premium',
                            // Scripts y tracking
                            '.pixelcontabilizacion',
                            '.loading-module',
                            // Paneles laterales
                            '.lightbox_shadow',
                            '.right-panel'
                        ].join(', ')
                    },

                    // -----------------------------------------------------------------
                    // ABC
                    // -----------------------------------------------------------------
                    'abc.es': {
                        title: 'h1, .voc-title',
                        content: '.voc-article-container, .voc-article--detail, .voc-d__article',
                        author: '.voc-author__name',
                        authorImage: '.voc-author__image img',  // Imagen del autor
                        images: '.voc-info-container .voc-img, .voc-img-container img, .voc-img-figure img, .voc-img, img.voc-img',
                        imageCaptionText: '.voc-figcaption--text',  // Texto del pie de foto
                        imageCaptionAuthor: '.voc-figcaption--autho',  // Autor del pie de foto
                        date: '.voc-author__time, time',
                        videoContainers: '.video, .nibara-element',  // Contenedores de video Brightcove
                        exclude: '.voc-header, .voc-header-news, .voc-advertising, .voc-breadcrumbs, .voc-social, .voc-share-social, .voc-save-news, .voc-comments-panel, #disqus_thread, #comments-container, .voc-see-comments, .voc-d-c-related-news, .voc-most-read, .voc-ob-wrapper, .voc-ints, .voc-cope-mod, .voc-discounts, .paywall2, .voc-premium, .voc-footer, .voc-onplus, .voc-btn__container'
                    }
                };

                this.init();
                this.resetDropdownOptions();
                this.focusSearchInput();
            }

            init() {
                this.elements.searchButton.addEventListener('click', () => this.search());
                this.elements.searchInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.search();
                });
                this.elements.countSelect.addEventListener('change', () => {
                    if (this.currentQuery) this.search();
                });
                this.elements.sourcesSelect.addEventListener('change', () => {
                    if (this.allNews.length > 0) this.displayFilteredNews();
                });
                this.elements.readingModeSwitch.addEventListener('change', () => {
                    if (this.allNews.length > 0) this.displayFilteredNews();
                });

                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && this.elements.modal.classList.contains('show')) {
                        this.closeModal();
                    }
                });

                this.elements.modal.addEventListener('click', (e) => {
                    if (e.target === this.elements.modal) this.closeModal();
                });

                this.elements.modalClose.addEventListener('click', () => this.closeModal());
                this.elements.modalBack.addEventListener('click', () => this.goBack());

                // Delegaci贸n de eventos para modal triggers (prevenir duplicaci贸n en m贸vil)
                let isProcessing = false;
                let lastClickedElement = null;
                let lastClickTime = 0;
                
                const handleNewsClick = (e, eventType) => {
                    const trigger = e.target.closest('.modal-trigger');
                    if (!trigger) return;
                    
                    e.preventDefault();
                    e.stopPropagation();
                    e.stopImmediatePropagation();
                    
                    const now = Date.now();
                    
                    // Prevenir duplicados: mismo elemento en menos de 500ms
                    if (trigger === lastClickedElement && (now - lastClickTime) < 500) {
                        console.log(` Clic duplicado bloqueado (${eventType})`);
                        return;
                    }
                    
                    // Prevenir si ya estamos procesando otro clic
                    if (isProcessing) {
                        console.log(` Ya procesando otra noticia (${eventType})`);
                        return;
                    }
                    
                    isProcessing = true;
                    lastClickedElement = trigger;
                    lastClickTime = now;
                    
                    console.log(` Abriendo noticia (${eventType})`);
                    
                    const { link, title, author, date, subtitle } = trigger.dataset;
                    this.openNewsPopup(
                        decodeURIComponent(link),
                        decodeURIComponent(title),
                        decodeURIComponent(author),
                        decodeURIComponent(date),
                        decodeURIComponent(subtitle || '')
                    );
                    
                    // Resetear flag despu茅s de 300ms
                    setTimeout(() => {
                        isProcessing = false;
                    }, 300);
                };
                
                // Manejar eventos t谩ctiles (m贸vil) y clicks (desktop)
                this.elements.resultsContainer.addEventListener('touchend', (e) => handleNewsClick(e, 'touch'), { passive: false });
                this.elements.resultsContainer.addEventListener('click', (e) => handleNewsClick(e, 'click'), { passive: false });

                // Toggle del desplegable de peri贸dicos
                const newspapersButton = document.getElementById('newspapersButton');
                const newspapersDropdown = document.getElementById('newspapersDropdown');

                newspapersButton.addEventListener('click', (e) => {
                    e.stopPropagation();
                    newspapersDropdown.classList.toggle('show');
                });

                // Cerrar al hacer clic fuera
                document.addEventListener('click', (e) => {
                    if (!newspapersButton.contains(e.target) && !newspapersDropdown.contains(e.target)) {
                        newspapersDropdown.classList.remove('show');
                    }
                });

                // Click en peri贸dico para buscar
                const self = this;
                document.querySelectorAll('.newspapers-dropdown__item').forEach(item => {
                    item.addEventListener('click', async (e) => {
                        e.stopPropagation();
                        e.preventDefault();

                        const domain = item.getAttribute('data-domain');
                        const newspaperName = item.querySelector('.newspapers-dropdown__text').textContent;

                        // Cerrar el desplegable
                        newspapersDropdown.classList.remove('show');

                        // Hacer una nueva b煤squeda con ese peri贸dico
                        try {
                            await self.searchByNewspaper(domain, newspaperName);
                        } catch (error) {
                            alert('Error al buscar: ' + error.message);
                        }
                    });
                });

                // Bot贸n de exportar peri贸dicos nuevos
                const exportBtn = document.getElementById('exportNewspapersBtn');
                exportBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.exportNewNewspapers();
                });
            }

            exportNewNewspapers() {
                // Obtener peri贸dicos configurados con sus dominios
                const configuredNewspapers = [
                    { name: 'ABC', domain: 'abc.es' },
                    { name: 'Antena 3', domain: 'antena3.com' },
                    { name: 'ARA', domain: 'es.ara.cat' },
                    { name: 'Cadena SER', domain: 'cadenaser.com' },
                    { name: 'CATALUNYAPRESS.ES', domain: 'catalunyapress.es' },
                    { name: 'Cope.es', domain: 'cope.es' },
                    { name: 'CUADERNOSDESEGURIDAD.COM', domain: 'cuadernosdeseguridad.com' },
                    { name: 'Deia.eus', domain: 'deia.eus' },
                    { name: 'Dem贸crata', domain: 'democrata.es' },
                    { name: 'DIARIODEMALLORCA.ES', domain: 'diariodemallorca.es' },
                    { name: 'DIARIOSOCIALISTA.NET', domain: 'diariosocialista.net' },
                    { name: 'DIARIOSUR.ES', domain: 'diariosur.es' },
                    { name: 'Diariosigloxxi.com', domain: 'diariosigloxxi.com' },
                    { name: 'EL CONFIDENCIAL', domain: 'elconfidencial.com' },
                    { name: 'elDEBATE', domain: 'eldebate.com' },
                    { name: 'ELCORREO.COM', domain: 'elcorreo.com' },
                    { name: 'ELDIA.ES', domain: 'eldia.es' },
                    { name: 'Eldiario.es', domain: 'eldiario.es' },
                    { name: 'Eldiariodemadrid.es', domain: 'eldiariodemadrid.es' },
                    { name: 'ELCONFIDENCIALDIGITAL.COM', domain: 'elconfidencialdigital.com' },
                    { name: 'El Espa帽ol', domain: 'elespanol.com' },
                    { name: 'ELGLOBALFARMA.COM', domain: 'elglobalfarma.com' },
                    { name: 'El HuffPost', domain: 'huffingtonpost.es' },
                    { name: 'El Independiente', domain: 'elindependiente.com' },
                    { name: 'El Mundo', domain: 'elmundo.es' },
                    { name: 'ELMUNDOTODAY.COM', domain: 'elmundotoday.com' },
                    { name: 'ELNOTICIERODIGITAL.COM', domain: 'elnoticierodigital.com' },
                    { name: 'El Pa铆s', domain: 'elpais.com' },
                    { name: 'El Peri贸dico', domain: 'elperiodico.com' },
                    { name: 'ELTELEVISERO.HUFFINGTONPOST.ES', domain: 'eltelevisero.huffingtonpost.es' },
                    { name: 'Epe.es', domain: 'epe.es' },
                    { name: 'ESCUDODIGITAL.COM', domain: 'escudodigital.com' },
                    { name: 'ESTRELLADIGITAL.ES', domain: 'estrelladigital.es' },
                    { name: 'EUROCARNE.COM', domain: 'eurocarne.com' },
                    { name: 'Europa Press', domain: 'europapress.es' },
                    { name: 'GACETAMEDICA.COM', domain: 'gacetamedica.com' },
                    { name: 'Gacetinmadrid.com', domain: 'gacetinmadrid.com' },
                    { name: 'HOYARAGON.ES', domain: 'hoyaragon.es' },
                    { name: 'INFOBAE.COM', domain: 'infobae.com' },
                    { name: 'INFOLIBRE', domain: 'infolibre.es' },
                    { name: 'INFOPLAY.INFO', domain: 'infoplay.info' },
                    { name: 'INSST.ES', domain: 'insst.es' },
                    { name: 'INTEREMPRESAS.NET', domain: 'interempresas.net' },
                    { name: 'Joan Seguidor', domain: 'joanseguidor.com' },
                    { name: 'LA RAZN', domain: 'larazon.es' },
                    { name: 'LAMONCLOA.GOB.ES', domain: 'lamoncloa.gob.es' },
                    { name: 'LAOPINIONDEZAMORA.ES', domain: 'laopiniondezamora.es' },
                    { name: 'laSexta', domain: 'lasexta.com' },
                    { name: 'La Vanguardia', domain: 'lavanguardia.com' },
                    { name: 'LIBERTAD DIGITAL', domain: 'libertaddigital.com' },
                    { name: 'MASPALOMAS24H.COM', domain: 'maspalomas24h.com' },
                    { name: 'Naiz', domain: 'naiz.eus' },
                    { name: 'Newtral.es', domain: 'newtral.es' },
                    { name: 'NOTEOLVIDESDELSAHARAOCCIDENTAL.ORG', domain: 'noteolvidesdelsaharaoccidental.org' },
                    { name: 'NUEVATRIBUNA.ES', domain: 'nuevatribuna.es' },
                    { name: 'OKDIARIO', domain: 'okdiario.com' },
                    { name: 'ONDACERO.ES', domain: 'ondacero.es' },
                    { name: 'PRESSDIGITAL.ES', domain: 'pressdigital.es' },
                    { name: 'P煤blico', domain: 'publico.es' },
                    { name: 'PUERTOLLANO.ES', domain: 'puertollano.es' },
                    { name: 'Radiopopular.com', domain: 'radiopopular.com' },
                    { name: 'RTVE', domain: 'rtve.es' },
                    { name: 'SALAMANCARTVALDIA.ES', domain: 'salamancartvaldia.es' },
                    { name: 'Telecinco', domain: 'telecinco.es' },
                    { name: 'Telemadrid.es', domain: 'telemadrid.es' },
                    { name: 'Teleprensa', domain: 'teleprensa.com' },
                    { name: 'VALENCIAPLAZA.COM', domain: 'valenciaplaza.com' }
                ];

                // Crear sets para comparaci贸n r谩pida
                const configuredNames = new Set(configuredNewspapers.map(np => np.name.toLowerCase()));
                const configuredDomains = new Set(configuredNewspapers.map(np => np.domain.toLowerCase()));

                // Obtener todos los peri贸dicos 煤nicos con sus dominios
                const newspapersMap = new Map();
                this.allNews.forEach(news => {
                    if (news.author && news.author !== 'Desconocido' && news.link) {
                        try {
                            const domain = new URL(news.link).hostname.replace('www.', '');
                            newspapersMap.set(news.author, domain);
                        } catch (e) {
                            // Ignorar URLs inv谩lidas
                        }
                    }
                });

                // Filtrar los que NO est谩n configurados (ni por nombre ni por dominio)
                const newNewspapers = [];
                newspapersMap.forEach((domain, newspaper) => {
                    const isNameConfigured = configuredNames.has(newspaper.toLowerCase());
                    const isDomainConfigured = configuredDomains.has(domain.toLowerCase());

                    if (!isNameConfigured && !isDomainConfigured) {
                        newNewspapers.push({ name: newspaper, domain: domain });
                    }
                });

                // Si no hay peri贸dicos nuevos
                if (newNewspapers.length === 0) {
                    alert('No se encontraron peri贸dicos nuevos en los resultados actuales.');
                    return;
                }

                // Ordenar alfab茅ticamente por nombre
                newNewspapers.sort((a, b) => a.name.localeCompare(b.name, 'es', { sensitivity: 'base' }));

                // Crear contenido del archivo con formato: NOMBRE (dominio.es)
                const content = newNewspapers.map(np =>
                    `${np.name.toUpperCase()} (${np.domain})`
                ).join('\n');

                // Crear blob y descargar
                const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `peri贸dicos_nuevos_${new Date().toISOString().split('T')[0]}.txt`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);

                alert(`Se han exportado ${newNewspapers.length} peri贸dicos nuevos.`);
            }

            async search() {
                const query = this.elements.searchInput.value.trim();
                if (!query) {
                    alert('Por favor, introduce un t茅rmino de b煤squeda');
                    return;
                }

                this.currentQuery = query;
                this.allNews = [];

                this.showLoading(true);
                this.hideMessages();

                try {
                    const allNews = await this.searchWithDifferentProxies(query);

                    if (allNews.length === 0) {
                        this.showNoResults();
                        this.resetDropdownOptions();
                    } else {
                        const filteredNews = this.filterNewsByQuery(allNews, query);

                        if (filteredNews.length === 0) {
                            this.showNoResults();
                            this.resetDropdownOptions();
                        } else {
                            const sortedNews = this.sortNewsByDate(filteredNews);
                            const maxCount = parseInt(this.elements.countSelect.value);
                            const limitedNews = sortedNews.slice(0, maxCount);

                            this.allNews = limitedNews;
                            this.updateNewsCounts();
                            this.updateDropdownWithCounters();
                            this.displayFilteredNews();
                        }
                    }
                } catch (error) {
                    this.showError();
                } finally {
                    this.showLoading(false);
                }
            }

            async searchWithDifferentProxies(query) {
                const allResults = [];
                const maxCount = parseInt(this.elements.countSelect.value);
                const numResults = maxCount + 20;
                const selectedValue = this.elements.sourcesSelect.value;

                let googleNewsUrl = this.buildGoogleNewsUrl(query, selectedValue, numResults);

                console.log(' Buscando noticias con:', query);
                console.log(' User Agent:', navigator.userAgent);

                for (let i = 0; i < this.proxies.length; i++) {
                    const proxy = this.proxies[i];
                    try {
                        console.log(` Intentando proxy ${i + 1}/${this.proxies.length}:`, proxy);
                        
                        const proxyUrl = this.buildProxyUrl(proxy, googleNewsUrl);
                        
                        // Timeout adaptativo: 10 segundos en ordenador, 20 en m贸vil
                        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
                        const timeout = isMobile ? 20000 : 10000;
                        const controller = new AbortController();
                        const timeoutId = setTimeout(() => controller.abort(), timeout);
                        
                        const response = await fetch(proxyUrl, {
                            signal: controller.signal,
                            headers: {
                                'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',
                                'Accept-Language': 'es-ES,es;q=0.9'
                            }
                        });
                        
                        clearTimeout(timeoutId);

                        console.log(` Respuesta del proxy ${i + 1}:`, response.status);

                        if (response.ok) {
                            const htmlContent = await response.text();
                            console.log(` HTML recibido (${htmlContent.length} caracteres)`);
                            
                            const news = this.parseGoogleNewsResults(htmlContent);
                            console.log(` Noticias parseadas: ${news.length}`);

                            if (news.length > 0) {
                                allResults.push(...news);
                                console.log(` xito con proxy ${i + 1}!`);
                                break;
                            } else {
                                console.log(`锔 Proxy ${i + 1} no devolvi贸 noticias, probando siguiente...`);
                            }
                        }
                    } catch (error) {
                        console.error(` Error con proxy ${i + 1}:`, error.message);
                        if (i === this.proxies.length - 1) {
                            console.error(' Todos los proxies fallaron');
                        }
                        continue;
                    }
                }

                console.log(` Total noticias encontradas: ${allResults.length}`);
                return allResults;
            }

            buildGoogleNewsUrl(query, selectedValue, numResults) {
                if (selectedValue !== 'all') {
                    const selectedDomain = this.newspaperToDomain[selectedValue];
                    return selectedDomain ?
                        `https://www.google.com/search?q=site:${selectedDomain}+${encodeURIComponent(query)}&tbm=nws&tbs=qdr:w&hl=es&gl=es&lr=lang_es&ie=UTF-8&oe=UTF-8&num=${numResults}` :
                        `https://www.google.com/search?q=${encodeURIComponent(query)}&tbm=nws&qdr:m&hl=es&gl=es&lr=lang_es&ie=UTF-8&oe=UTF-8&num=${numResults}`;
                }
                return `https://www.google.com/search?q=${encodeURIComponent(query)}&tbm=nws&qdr:m&hl=es&gl=es&lr=lang_es&ie=UTF-8&oe=UTF-8&num=${numResults}`;
            }

            buildProxyUrl(proxy, url) {
                if (proxy.includes('corsproxy.io') || proxy.includes('api.codetabs.com')) {
                    return proxy + encodeURIComponent(url);
                }
                return proxy + url;
            }

            parseGoogleNewsResults(html) {
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const news = [];

                const possibleSelectors = ['.g', '.mnr-c', '.SoaBEf', '.xrnccd', 'div[data-hveid]', '.dbsr > div', '.Gx5Zad'];

                for (const selector of possibleSelectors) {
                    const newsItems = doc.querySelectorAll(selector);

                    if (newsItems.length > 0) {
                        newsItems.forEach(item => {
                            const newsItem = this.extractNewsItemData(item);
                            if (newsItem) news.push(newsItem);
                        });

                        if (news.length > 0) break;
                    }
                }

                return news;
            }

            extractNewsItemData(item) {
                try {
                    const titleSelectors = ['h3', '.DI9d6d', '.LC20lb', '.mCBkyc', '.n0jPhd'];
                    const titleElement = this.findFirstElement(item, titleSelectors);
                    const linkElement = item.querySelector('a');

                    if (titleElement && linkElement) {
                        const title = this.cleanText(titleElement.textContent);
                        let link = linkElement.href;

                        if (link.includes('/url?q=')) {
                            const urlParams = new URLSearchParams(link.split('?')[1]);
                            link = urlParams.get('q') || link;
                        }

                        const hostname = this.extractHostname(link);

                        if (title && hostname) {
                            const dateElement = this.findDateElement(item);
                            const snippetElement = this.findSnippetElement(item);
                            const finalSubtitle = this.extractSubtitle(snippetElement);

                            return {
                                title: title,
                                subtitle: finalSubtitle,
                                link: link,
                                date: dateElement ? this.parseDate(this.cleanText(dateElement.textContent)) : 'Fecha no disponible',
                                author: this.inferAuthorFromHost(hostname)
                            };
                        }
                    }
                } catch (e) {
                    // Ignorar errores de parsing
                }
                return null;
            }

            findFirstElement(parent, selectors) {
                for (const selector of selectors) {
                    const element = parent.querySelector(selector);
                    if (element) return element;
                }
                return null;
            }

            findDateElement(item) {
                const dateSelectors = ['.f', '.LGOjhe', '.MgUUmf', '.OSrXXb', 'span'];
                for (const selector of dateSelectors) {
                    const element = item.querySelector(selector);
                    if (element && this.isDateText(element.textContent)) {
                        return element;
                    }
                }
                return null;
            }

            findSnippetElement(item) {
                const snippetSelectors = ['.ilUpNd.H66NU.aSRlid', '.GI74Re.nDgy9d', '.GI74Re', '.st', '.s3v9rd', '.VwiC3b', '.Y3v8qd'];
                for (const selector of snippetSelectors) {
                    const element = item.querySelector(selector);
                    if (element && element.textContent?.trim()) {
                        let snippetText = element.textContent.trim();
                        snippetText = snippetText.replace(/\s*\d+\s+(hours?|days?|minutes?)\s+ago$/gi, '');
                        if (snippetText.length > 10) {
                            return element;
                        }
                    }
                }
                return null;
            }

            extractSubtitle(snippetElement) {
                if (snippetElement && snippetElement.textContent?.trim()) {
                    let finalSubtitle = this.cleanText(snippetElement.textContent);
                    return finalSubtitle.replace(/\s*\d+\s+(hours?|days?|minutes?)\s+ago$/gi, '');
                }
                return '';
            }

            extractHostname(url) {
                try {
                    return new URL(url).hostname.replace(/^www\./, '');
                } catch {
                    return '';
                }
            }

            isDateText(text) {
                if (!text) return false;
                const dateKeywords = [
                    'hace', 'hour', 'day', 'ago', 'min', 'minute', 'minuto', 'hora', 'd铆a', 'week', 'semana', 'month', 'mes',
                    'ene', 'feb', 'mar', 'abr', 'may', 'jun', 'jul', 'ago', 'sep', 'oct', 'nov', 'dic',
                    'jan', 'feb', 'mar', 'apr', 'may', 'jun', 'jul', 'aug', 'sep', 'oct', 'nov', 'dec'
                ];
                return dateKeywords.some(keyword => text.toLowerCase().includes(keyword));
            }

            parseDate(dateStr) {
                if (!dateStr) return 'Fecha no disponible';

                const now = new Date();
                const originalDate = dateStr;

                // Log para depuraci贸n
                if (Math.random() < 0.1) {  // Solo 10% para no saturar
                    console.log(` parseDate recibi贸: "${originalDate}"`);
                }

                // Minutos - Espa帽ol
                if (dateStr.includes('minuto')) {
                    const match = dateStr.match(/(\d+)\s*minuto/i);
                    const minutes = match ? parseInt(match[1]) : 1;
                    return minutes === 1 ? 'Hace 1 minuto' : `Hace ${minutes} minutos`;
                }

                // Horas - Espa帽ol
                if (dateStr.includes('hora')) {
                    const match = dateStr.match(/(\d+)\s*hora/i);
                    const hours = match ? parseInt(match[1]) : 1;
                    return hours === 1 ? 'Hace 1 hora' : `Hace ${hours} horas`;
                }

                // D铆as - Espa帽ol
                if (dateStr.includes('d铆a')) {
                    const match = dateStr.match(/(\d+)\s*d铆a/i);
                    const days = match ? parseInt(match[1]) : 1;
                    return days === 1 ? 'Hace 1 d铆a' : `Hace ${days} d铆as`;
                }

                // Horas - Ingl茅s
                if (dateStr.includes('hour') || dateStr.includes('hr')) {
                    const match = dateStr.match(/(\d+)\s*(hour|hr)/i);
                    const hours = match ? parseInt(match[1]) : 1;
                    return hours === 1 ? 'Hace 1 hora' : `Hace ${hours} horas`;
                }

                // Minutos - Ingl茅s
                if (dateStr.includes('minute') || dateStr.includes('min')) {
                    const match = dateStr.match(/(\d+)\s*(minute|min)/i);
                    const minutes = match ? parseInt(match[1]) : 1;
                    return minutes === 1 ? 'Hace 1 minuto' : `Hace ${minutes} minutos`;
                }

                // D铆as - Ingl茅s
                if (dateStr.includes('day')) {
                    const match = dateStr.match(/(\d+)\s*day/i);
                    const days = match ? parseInt(match[1]) : 1;
                    return days === 1 ? 'Hace 1 d铆a' : `Hace ${days} d铆as`;
                }

                // Semanas
                if (dateStr.includes('week') || dateStr.includes('semana')) {
                    const match = dateStr.match(/(\d+)\s*(week|semana)/i);
                    const weeks = match ? parseInt(match[1]) : 1;
                    return weeks === 1 ? 'Hace 1 semana' : `Hace ${weeks} semanas`;
                }

                // Meses
                if (dateStr.includes('month') || dateStr.includes('mes')) {
                    const match = dateStr.match(/(\d+)\s*(month|mes)/i);
                    const months = match ? parseInt(match[1]) : 1;
                    return months === 1 ? 'Hace 1 mes' : `Hace ${months} meses`;
                }

                // Ya est谩 en formato "Hace X..."
                if (dateStr.includes('Hace') || dateStr.includes('hace')) {
                    return dateStr;
                }

                // Intentar parsear como fecha absoluta
                const parsed = new Date(dateStr);
                if (!isNaN(parsed.getTime())) {
                    return this.formatDate(parsed);
                }

                // Si nada funciona, devolver el original
                console.warn(`锔 No se pudo parsear fecha: "${originalDate}"`);
                return dateStr;
            }

            formatDate(date) {
                const options = {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                };
                return date.toLocaleDateString('es-ES', options);
            }

            parseDateForSorting(dateStr) {
                if (!dateStr || dateStr === 'Fecha no disponible') {
                    return new Date(0);
                }

                const now = new Date();

                // Minutos - Espa帽ol e Ingl茅s
                if (dateStr.includes('minuto') || dateStr.includes('minute') || dateStr.includes('min')) {
                    const match = dateStr.match(/(\d+)\s*(minuto|minute|min)/i);
                    const minutes = match ? parseInt(match[1]) : 1;
                    return new Date(now.getTime() - (minutes * 60 * 1000));
                }

                // Horas - Espa帽ol e Ingl茅s
                if (dateStr.includes('hora') || dateStr.includes('hour') || dateStr.includes('hr')) {
                    const match = dateStr.match(/(\d+)\s*(hora|hour|hr)/i);
                    const hours = match ? parseInt(match[1]) : 1;
                    return new Date(now.getTime() - (hours * 60 * 60 * 1000));
                }

                // D铆as - Espa帽ol e Ingl茅s
                if (dateStr.includes('d铆a') || dateStr.includes('day')) {
                    const match = dateStr.match(/(\d+)\s*(d铆a|day)/i);
                    const days = match ? parseInt(match[1]) : 1;
                    return new Date(now.getTime() - (days * 24 * 60 * 60 * 1000));
                }

                // Semanas - Espa帽ol e Ingl茅s
                if (dateStr.includes('semana') || dateStr.includes('week')) {
                    const match = dateStr.match(/(\d+)\s*(semana|week)/i);
                    const weeks = match ? parseInt(match[1]) : 1;
                    return new Date(now.getTime() - (weeks * 7 * 24 * 60 * 60 * 1000));
                }

                // Meses - Espa帽ol e Ingl茅s
                if (dateStr.includes('mes') || dateStr.includes('month')) {
                    const match = dateStr.match(/(\d+)\s*(mes|month)/i);
                    const months = match ? parseInt(match[1]) : 1;
                    return new Date(now.getTime() - (months * 30 * 24 * 60 * 60 * 1000));
                }

                // Intentar parsear como fecha absoluta
                const parsed = new Date(dateStr);
                return !isNaN(parsed.getTime()) ? parsed : new Date(0);
            }

            sortNewsByDate(news) {
                return [...news].sort((a, b) => {
                    const dateA = this.parseDateForSorting(a.date);
                    const dateB = this.parseDateForSorting(b.date);
                    return dateB - dateA;
                });
            }

            normalizeText(text) {
                if (!text) return '';
                // Normalizar a NFD (descomponer caracteres con acentos) y eliminar marcas diacr铆ticas
                return text.normalize('NFD').replace(/[\u0300-\u036f]/g, '').toLowerCase();
            }

            filterNewsByQuery(news, query) {
                const queryNormalized = this.normalizeText(query);
                return news.filter(item => {
                    const titleNormalized = this.normalizeText(item.title);
                    const subtitleNormalized = this.normalizeText(item.subtitle || '');
                    return titleNormalized.includes(queryNormalized) || subtitleNormalized.includes(queryNormalized);
                });
            }

            getSelectedNewspaperDomain(selectedValue) {
                return this.newspaperToDomain[selectedValue] || null;
            }

            getNewspaperValue(newspaperName) {
                return this.nameToValue[newspaperName] || newspaperName.toLowerCase().replace(/\s+/g, '');
            }

            inferAuthorFromHost(hostname) {
                const host = (hostname || '').replace(/^www\./, '');
                return this.knownSources[host] || this.capitalizeFirstLetter(host) || 'Desconocido';
            }

            capitalizeFirstLetter(string) {
                return string ? string.charAt(0).toUpperCase() + string.slice(1) : '';
            }

            decodeHtmlEntities(text) {
                if (!text) return '';
                const textarea = document.createElement('textarea');
                textarea.innerHTML = text;
                return (textarea.textContent || textarea.value || text).trim();
            }

            fixMojibake(text) {
                if (!text) return '';
                const looksBroken = /[]|芒|芒|芒|芒"|芒"/.test(text);
                return looksBroken ? text : text;
            }

            cleanText(text) {
                if (!text) return '';
                let result = this.decodeHtmlEntities(String(text));
                result = this.fixMojibake(result);
                result = result.replace(/\s+/g, ' ').normalize('NFC');
                return result.trim();
            }

            displayNews(news) {
                console.log(` displayNews llamado con ${news.length} noticias`);
                
                // Estad铆stica de subt铆tulos
                const withSubtitle = news.filter(n => n.subtitle && n.subtitle.trim()).length;
                console.log(` ${withSubtitle} de ${news.length} noticias tienen subt铆tulo (${Math.round(withSubtitle/news.length*100)}%)`);
                
                this.elements.resultsContainer.innerHTML = '';

                news.forEach((item, index) => {
                    if (index < 3) {  // Log solo las primeras 3 noticias
                        console.log(` Noticia ${index + 1}:`);
                        console.log(`    T铆tulo: "${item.title.substring(0, 50)}..."`);
                        console.log(`    Subt铆tulo: ${item.subtitle ? '"' + item.subtitle.substring(0, 50) + '..."' : ' NO TIENE'}`);
                        console.log(`    Fecha: "${item.date}"`);
                    }
                    
                    const isPopupMode = this.elements.readingModeSwitch.checked;
                    const linkHTML = isPopupMode ?
                        `<a href="#" class="modal-trigger" data-link="${encodeURIComponent(item.link)}" data-title="${encodeURIComponent(item.title)}" data-author="${encodeURIComponent(item.author)}" data-date="${encodeURIComponent(item.date)}" data-subtitle="${encodeURIComponent(item.subtitle || '')}">${item.title}</a>` :
                        `<a href="${item.link}" target="_blank">${item.title}</a>`;

                    const subtitleHTML = item.subtitle ? (isPopupMode ?
                        `<a href="#" class="modal-trigger" data-link="${encodeURIComponent(item.link)}" data-title="${encodeURIComponent(item.title)}" data-author="${encodeURIComponent(item.author)}" data-date="${encodeURIComponent(item.date)}" data-subtitle="${encodeURIComponent(item.subtitle || '')}">${item.subtitle}</a>` :
                        `<a href="${item.link}" target="_blank">${item.subtitle}</a>`) : '';

                    const newsElement = document.createElement('div');
                    newsElement.className = 'news-item';
                    newsElement.innerHTML = `
                        <div class="news-content">
                            <div class="news-source-time">
                                <div class="news-source">${item.author}</div>
                                <div class="news-time">${item.date}</div>
                            </div>
                            <div class="news-title">
                                <h3>${linkHTML}</h3>
                            </div>
                            ${item.subtitle ? `<div class="news-subtitle">${subtitleHTML}</div>` : ''}
                        </div>
                    `;

                    this.elements.resultsContainer.appendChild(newsElement);
                    
                    // Verificar subt铆tulo en DOM (solo primeras 3)
                    if (index < 3 && item.subtitle) {
                        setTimeout(() => {
                            const subtitleInDOM = newsElement.querySelector('.news-subtitle');
                            if (subtitleInDOM) {
                                const styles = window.getComputedStyle(subtitleInDOM);
                                console.log(` Noticia ${index + 1} - Subt铆tulo en DOM: `);
                                console.log(`   Display: ${styles.display}, Visibility: ${styles.visibility}`);
                                console.log(`   Height: ${styles.height}, Overflow: ${styles.overflow}`);
                            } else {
                                console.log(` Noticia ${index + 1} - Subt铆tulo NO encontrado en DOM`);
                            }
                        }, 100);
                    }
                });
            }

            showLoading(show) {
                this.elements.loading.style.display = show ? 'block' : 'none';
                this.elements.searchButton.disabled = show;
                this.elements.searchButton.textContent = show ? 'Buscando...' : 'Buscar';
            }

            showError() {
                this.elements.errorMessage.style.display = 'block';
            }

            showNoResults() {
                this.elements.noResults.style.display = 'block';
            }

            hideMessages() {
                this.elements.errorMessage.style.display = 'none';
                this.elements.noResults.style.display = 'none';
                this.elements.resultsContainer.innerHTML = '';
            }

            updateNewsCounts() {
                const counts = { 'all': this.allNews.length };

                this.allNews.forEach(news => {
                    const author = news.author;
                    if (author && author !== 'Desconocido') {
                        counts[author] = (counts[author] || 0) + 1;
                    }
                });

                this.newsCounts = counts;
            }

            updateDropdownWithCounters() {
                const currentValue = this.elements.sourcesSelect.value;

                let optionsHTML = `<option value="all">Todos los peri贸dicos (${this.newsCounts.all})</option>`;

                const newspapers = Object.keys(this.newsCounts)
                    .filter(key => key !== 'all' && this.newsCounts[key] > 0)
                    .sort((a, b) => a.localeCompare(b, 'es', { sensitivity: 'base' }));

                newspapers.forEach(newspaper => {
                    const count = this.newsCounts[newspaper];
                    const value = this.getNewspaperValue(newspaper);
                    optionsHTML += `<option value="${value}">${newspaper} (${count})</option>`;
                });

                this.elements.sourcesSelect.innerHTML = optionsHTML;

                if (currentValue && this.elements.sourcesSelect.querySelector(`option[value="${currentValue}"]`)) {
                    this.elements.sourcesSelect.value = currentValue;
                } else {
                    this.elements.sourcesSelect.value = 'all';
                }
            }

            resetDropdownOptions() {
                this.elements.sourcesSelect.innerHTML = `<option value="all">Todos los peri贸dicos</option>`;
                this.elements.sourcesSelect.value = 'all';
            }

            focusSearchInput() {
                setTimeout(() => {
                    if (this.elements.searchInput) {
                        this.elements.searchInput.focus();
                    }
                }, 100);
            }

            async searchByNewspaper(domain, newspaperName) {
                const query = this.elements.searchInput.value.trim();

                if (!query) {
                    alert('Por favor, introduce una palabra de b煤squeda primero');
                    return;
                }

                // Mostrar loading
                this.showLoading(true);

                try {
                    const maxCount = parseInt(this.elements.countSelect.value);
                    const numResults = maxCount + 20;

                    // Construir URL con site:dominio
                    const googleNewsUrl = `https://www.google.com/search?q=site:${domain}+${encodeURIComponent(query)}&tbm=nws&tbs=qdr:w&hl=es&gl=es&lr=lang_es&ie=UTF-8&oe=UTF-8&num=${numResults}`;

                    let allResults = [];

                    // Usar solo api.codetabs.com
                    const preferredProxies = ['https://api.codetabs.com/v1/proxy?quest=', 'https://corsproxy.io/?'];

                    for (const proxy of preferredProxies) {
                        try {
                            const proxyUrl = proxy + encodeURIComponent(googleNewsUrl);
                            const response = await fetch(proxyUrl);

                            if (response.ok) {
                                const htmlContent = await response.text();
                                const news = this.parseGoogleNewsResults(htmlContent);

                                if (news.length > 0) {
                                    allResults.push(...news);
                                    break;
                                }
                            }
                        } catch (error) {
                            continue;
                        }
                    }

                    if (allResults.length === 0) {
                        this.showNoResults();
                        this.resetDropdownOptions();
                        return;
                    }

                    // Filtrar por texto de b煤squeda
                    const filteredNews = this.filterNewsByQuery(allResults, query);

                    if (filteredNews.length === 0) {
                        this.showNoResults();
                        this.resetDropdownOptions();
                        return;
                    }

                    // Ordenar por fecha
                    const sortedNews = this.sortNewsByDate(filteredNews);

                    // Limitar a maxCount
                    const limitedNews = sortedNews.slice(0, maxCount);

                    this.allNews = limitedNews;

                    // Actualizar contador de peri贸dicos
                    this.updateNewsCounts();
                    this.updateDropdownWithCounters();

                    // Mostrar noticias
                    this.displayFilteredNews();

                } catch (error) {
                    this.showError();
                } finally {
                    this.showLoading(false);
                }
            }

            displayFilteredNews() {
                let newsToShow = this.allNews;
                const selectedValue = this.elements.sourcesSelect.value;

                if (selectedValue !== 'all') {
                    // Buscar el peri贸dico que corresponde al valor seleccionado
                    const selectedNewspaper = Object.keys(this.newsCounts).find(newspaper => {
                        const newspaperValue = this.getNewspaperValue(newspaper);
                        return newspaperValue === selectedValue;
                    });

                    if (selectedNewspaper) {
                        newsToShow = this.allNews.filter(news => news.author === selectedNewspaper);
                    }
                }

                this.displayNews(newsToShow);
            }

            async openNewsPopup(link, title, author, date, subtitle) {
                this.modalHistory = [];
                this.hideBackButton();

                this.currentOriginalUrl = link;
                this.currentSubtitle = subtitle;

                this.modalHistory.push({ url: link, title: title });

                this.showModal(title, author, date, subtitle);

                this.elements.modalOriginalLink.href = link;

                // Asegurar que el bot贸n volver est茅 oculto en la primera modal
                this.hideBackButton();

                try {
                    await this.loadFullContent(link);
                } catch (error) {
                    this.showModalError('Error al cargar el contenido completo de la noticia.');
                }

                return false;
            }

            showModal(title, author, date, subtitle) {
                this.elements.modalTitle.textContent = title;
                this.elements.modalOriginalLink.href = '#';
                this.elements.modalOriginalLink.textContent = ' Abrir la noticia original';
                this.elements.modalBody.innerHTML = '<div class="modal-loading">Cargando contenido completo...</div>';

                this.elements.modal.style.display = 'flex';
                setTimeout(() => {
                    this.elements.modal.classList.add('show');
                }, 10);

                document.body.style.overflow = 'hidden';
            }

            closeModal() {
                // Detener todos los videos antes de cerrar el modal
                this.stopAllVideos();

                this.elements.modal.classList.remove('show');
                setTimeout(() => {
                    this.elements.modal.style.display = 'none';
                    document.body.style.overflow = 'auto';
                }, 300);

                this.modalHistory = [];
                this.hideBackButton();
            }

            stopAllVideos() {
                // Detener iframes (Dailymotion, Brightcove, Twitter, etc.)
                const iframes = this.elements.modalBody.querySelectorAll('iframe');
                iframes.forEach(iframe => {
                    // Establecer src a about:blank detiene completamente el iframe
                    iframe.src = 'about:blank';
                });

                // Detener videos HTML5 (MP4, HLS)
                const videos = this.elements.modalBody.querySelectorAll('video');
                videos.forEach(video => {
                    // Destruir instancia de HLS.js si existe
                    if (video._hls) {
                        video._hls.destroy();
                        video._hls = null;
                    }

                    video.pause();
                    video.currentTime = 0;
                    video.src = '';
                    video.load();
                });

                // Como medida adicional, limpiar todo el contenido del modal body
                // despu茅s de un peque帽o delay para dar tiempo a que los iframes se detengan
                setTimeout(() => {
                    this.elements.modalBody.innerHTML = '';
                }, 100);
            }

            goBack() {
                if (this.modalHistory.length > 1) {
                    this.modalHistory.pop();

                    const previousContent = this.modalHistory[this.modalHistory.length - 1];

                    // Cargar el contenido anterior sin a帽adir al historial
                    this.showModal(previousContent.title, '', '', '');
                    this.elements.modalOriginalLink.href = previousContent.url;

                    try {
                        this.loadFullContent(previousContent.url);
                    } catch (error) {
                        this.showModalError('Error al cargar el contenido completo de la noticia.');
                    }

                    // Ocultar bot贸n volver si estamos en la primera modal
                    if (this.modalHistory.length <= 1) {
                        this.hideBackButton();
                    }
                }
            }

            showBackButton() {
                if (this.elements.modalBack) {
                    this.elements.modalBack.style.display = 'block';
                }
            }

            hideBackButton() {
                if (this.elements.modalBack) {
                    this.elements.modalBack.style.display = 'none';
                }
            }

            async loadModalContent(url, title) {
                // Agregar al historial antes de cargar el contenido
                this.modalHistory.push({ url: url, title: title });
                if (this.modalHistory.length > 1) {
                    this.showBackButton();
                }

                this.showModal(title, '', '', '');
                this.elements.modalOriginalLink.href = url;

                try {
                    await this.loadFullContent(url);
                } catch (error) {
                    this.showModalError('Error al cargar el contenido completo de la noticia.');
                }
            }

            showModalError(message) {
                this.elements.modalBody.innerHTML = `<div class="modal-error">${message}</div>`;
            }

            async loadFullContent(url) {
                try {
                    let content = null;

                    for (const proxy of this.proxies) {
                        try {
                            const proxyUrl = this.buildProxyUrl(proxy, url);
                            const response = await fetch(proxyUrl);

                            if (response.ok) {
                                // Leer como buffer para detectar la codificaci贸n correcta
                                const buffer = await response.arrayBuffer();
                                const bytes = new Uint8Array(buffer);
                                
                                // Primero intentar decodificar como UTF-8
                                let decoder = new TextDecoder('utf-8', { fatal: true });
                                let html;
                                try {
                                    html = decoder.decode(bytes);
                                } catch (e) {
                                    // Si falla UTF-8, probar con Windows-1252
                                    decoder = new TextDecoder('windows-1252');
                                    html = decoder.decode(bytes);
                                }
                                
                                // Detectar la codificaci贸n declarada en el HTML
                                const charsetMatch = html.match(/<meta[^>]+charset=["']?([^"'\s>]+)/i);
                                if (charsetMatch) {
                                    const declaredCharset = charsetMatch[1].toLowerCase();
                                    
                                    // Si la codificaci贸n declarada es ISO-8859-1 o Windows-1252, redecodificar
                                    if (declaredCharset === 'iso-8859-1' || declaredCharset === 'windows-1252' || declaredCharset === 'latin1') {
                                        decoder = new TextDecoder('windows-1252');
                                        html = decoder.decode(bytes);
                                    }
                                }
                                
                                // Correcci贸n adicional por si acaso
                                html = this.fixEncoding(html);
                                
                                content = await this.extractArticleContent(html, url);

                                if (content && (content.text || content.images.length > 0)) {
                                    break;
                                }
                            }
                        } catch (error) {
                            continue;
                        }
                    }

                    content ? this.displayModalContent(content) : this.showModalError('No se pudo cargar el contenido completo de la noticia.');
                } catch (error) {
                    this.showModalError('Error al cargar el contenido completo.');
                }
            }

            fixEncoding(html) {
                // Detectar el car谩cter de reemplazo Unicode (锟) que indica problemas de codificaci贸n
                if (!html.includes('\uFFFD')) {
                    return html; // No hay problemas aparentes
                }
                
                try {
                    // Convertir a bytes y redecodificar como Windows-1252
                    const encoder = new TextEncoder();
                    const utf8Bytes = encoder.encode(html);
                    
                    // Decodificar como Windows-1252
                    const decoder = new TextDecoder('windows-1252');
                    let fixed = decoder.decode(utf8Bytes);
                    
                    // Si todav铆a tiene problemas, intentar ISO-8859-1
                    if (fixed.includes('\uFFFD')) {
                        const decoderISO = new TextDecoder('iso-8859-1');
                        fixed = decoderISO.decode(utf8Bytes);
                    }
                    
                    if (!fixed.includes('\uFFFD')) {
                        return fixed;
                    }
                    return html;
                } catch (e) {
                    return html;
                }
            }

            detectDailymotionVideos(html) {
                const videos = [];
                const seen = new Set();
                
                // Patr贸n 1: data-video-id="..."
                const dataVideoIdRegex = /data-video-id=["']([^"']+)["']/gi;
                let match;
                while ((match = dataVideoIdRegex.exec(html)) !== null) {
                    const videoId = match[1];
                    if (!seen.has(videoId)) {
                        seen.add(videoId);
                        videos.push({
                            type: 'Dailymotion',
                            id: videoId,
                            embedUrl: `https://www.dailymotion.com/embed/video/${videoId}?autoplay=0`
                        });
                    }
                }

                // Patr贸n 2: iframe src="https://www.dailymotion.com/embed/video/..."
                const iframeRegex = /src=["']https?:\/\/(?:www\.)?dailymotion\.com\/embed\/video\/([a-zA-Z0-9]+)[^"']*["']/gi;
                while ((match = iframeRegex.exec(html)) !== null) {
                    const videoId = match[1];
                    if (!seen.has(videoId)) {
                        seen.add(videoId);
                        videos.push({
                            type: 'Dailymotion',
                            id: videoId,
                            embedUrl: `https://www.dailymotion.com/embed/video/${videoId}?autoplay=0`
                        });
                    }
                }

                // Patr贸n 3: URL directa en el HTML: dailymotion.com/video/...
                const urlRegex = /dailymotion\.com\/video\/([a-zA-Z0-9]+)/gi;
                while ((match = urlRegex.exec(html)) !== null) {
                    const videoId = match[1];
                    if (!seen.has(videoId)) {
                        seen.add(videoId);
                        videos.push({
                            type: 'Dailymotion',
                            id: videoId,
                            embedUrl: `https://www.dailymotion.com/embed/video/${videoId}?autoplay=0`
                        });
                    }
                }

                // Patr贸n 4: data-src con dailymotion
                const dataSrcRegex = /data-src=["']https?:\/\/(?:www\.)?dailymotion\.com\/embed\/video\/([a-zA-Z0-9]+)[^"']*["']/gi;
                while ((match = dataSrcRegex.exec(html)) !== null) {
                    const videoId = match[1];
                    if (!seen.has(videoId)) {
                        seen.add(videoId);
                        videos.push({
                            type: 'Dailymotion',
                            id: videoId,
                            embedUrl: `https://www.dailymotion.com/embed/video/${videoId}?autoplay=0`
                        });
                    }
                }

                // Patr贸n 5: id="player_..._X" formato de elmundo.es
                // Ejemplo: id="player_68bfe1f9e85ecea4668b45a4_x9q9t8a" -> video ID es "x9q9t8a"
                const playerIdRegex = /id=["']player_[^"']*_([a-zA-Z0-9]+)["']/gi;
                while ((match = playerIdRegex.exec(html)) !== null) {
                    const videoId = match[1];
                    if (!seen.has(videoId)) {
                        seen.add(videoId);
                        videos.push({
                            type: 'Dailymotion',
                            id: videoId,
                            embedUrl: `https://www.dailymotion.com/embed/video/${videoId}?autoplay=0`
                        });
                    }
                }

                return videos;
            }

            detectElPaisVideos(html, doc) {
                const videos = [];
                const seen = new Set();

                // Funci贸n helper para normalizar URLs y crear keys 煤nicas
                const normalizeVideoUrl = (url) => {
                    // Eliminar par谩metros de query para comparaci贸n
                    return url.split('?')[0].toLowerCase();
                };

                // M茅todo 1: MP4 directo de vdmedia.elpais.com
                const elpaisMp4Regex = /https?:\/\/vdmedia\.elpais\.com\/[^"'\s]+\.mp4/gi;
                let match;
                while ((match = elpaisMp4Regex.exec(html)) !== null) {
                    const videoUrl = match[0];
                    const normalizedUrl = normalizeVideoUrl(videoUrl);

                    if (!seen.has(normalizedUrl)) {
                        seen.add(normalizedUrl);
                        const filename = videoUrl.split('/').pop().split('?')[0];
                        videos.push({
                            type: 'ElPais-MP4',
                            id: filename,
                            embedUrl: videoUrl,
                            isDirect: true
                        });
                    }
                }

                // M茅todo 2: JW Player - buscar "file":"...mp4/m3u8"
                const jwplayerRegex = /"file"\s*:\s*"([^"]+\.(?:mp4|m3u8)[^"]*)"/gi;
                while ((match = jwplayerRegex.exec(html)) !== null) {
                    let videoUrl = match[1];
                    if (videoUrl.startsWith('//')) videoUrl = 'https:' + videoUrl;
                    if (videoUrl.startsWith('/')) continue;

                    const normalizedUrl = normalizeVideoUrl(videoUrl);

                    if (!seen.has(normalizedUrl)) {
                        seen.add(normalizedUrl);
                        const isM3U8 = videoUrl.includes('.m3u8');
                        const filename = videoUrl.split('/').pop().split('?')[0];
                        videos.push({
                            type: isM3U8 ? 'HLS-Stream' : 'JWPlayer-MP4',
                            id: filename,
                            embedUrl: videoUrl,
                            isDirect: true
                        });
                    }
                }

                // M茅todo 3: MP4 directo en etiquetas <video> y <source>
                const mp4Regex = /<(?:video|source)[^>]+src=["']([^"']+\.mp4[^"']*)["']/gi;
                while ((match = mp4Regex.exec(html)) !== null) {
                    let videoUrl = match[1];
                    if (videoUrl.startsWith('//')) videoUrl = 'https:' + videoUrl;
                    if (videoUrl.startsWith('/')) continue;

                    const normalizedUrl = normalizeVideoUrl(videoUrl);

                    if (!seen.has(normalizedUrl)) {
                        seen.add(normalizedUrl);
                        const filename = videoUrl.split('/').pop().split('?')[0];
                        videos.push({
                            type: 'MP4-Direct',
                            id: filename,
                            embedUrl: videoUrl,
                            isDirect: true
                        });
                    }
                }

                return videos;
            }

            detectBlueskyVideos(html, doc) {
                const blueskyPosts = [];
                const seen = new Set();

                // Funci贸n para convertir at:// URI a URL HTTP de Bluesky
                const convertAtUri = (atUri) => {
                    const match = atUri.match(/at:\/\/(did:[^\/]+)\/app\.bsky\.feed\.post\/([^\/\s"']+)/i);
                    if (match) {
                        return {
                            url: `https://bsky.app/profile/${match[1]}/post/${match[2]}`,
                            did: match[1],
                            rkey: match[2]
                        };
                    }
                    return null;
                };

                // Funci贸n para extraer info de URL HTTP de Bluesky
                const extractFromUrl = (url) => {
                    const match = url.match(/bsky\.app\/profile\/(did:[^\/]+)\/post\/([^\/?\s"']+)/i);
                    if (match) {
                        return {
                            url: url,
                            did: match[1],
                            rkey: match[2]
                        };
                    }
                    return null;
                };

                // M茅todo 1: Buscar elementos con data-bluesky-uri (formato at://)
                doc.querySelectorAll('[data-bluesky-uri]').forEach(el => {
                    const atUri = el.getAttribute('data-bluesky-uri');
                    if (atUri && atUri.startsWith('at://')) {
                        const info = convertAtUri(atUri);
                        if (info) {
                            const key = `bsky-${info.did}-${info.rkey}`;
                            if (!seen.has(key)) {
                                seen.add(key);
                                blueskyPosts.push(info);
                            }
                        }
                    }
                });

                // M茅todo 2: Buscar elementos con clases o atributos relacionados con Bluesky
                doc.querySelectorAll('.embed-container--type-bluesky, .bluesky-embed, [data-bluesky-url], [class*="bluesky"]').forEach(el => {
                    const dataUrl = el.getAttribute('data-bluesky-url') ||
                                   el.getAttribute('data-url') ||
                                   el.getAttribute('cite');

                    if (dataUrl && dataUrl.includes('bsky')) {
                        const info = extractFromUrl(dataUrl);
                        if (info) {
                            const key = `bsky-${info.did}-${info.rkey}`;
                            if (!seen.has(key)) {
                                seen.add(key);
                                blueskyPosts.push(info);
                            }
                        }
                    }
                });

                // M茅todo 3: Buscar en blockquotes
                doc.querySelectorAll('blockquote').forEach(blockquote => {
                    const atUri = blockquote.getAttribute('data-bluesky-uri');
                    if (atUri && atUri.startsWith('at://')) {
                        const info = convertAtUri(atUri);
                        if (info) {
                            const key = `bsky-${info.did}-${info.rkey}`;
                            if (!seen.has(key)) {
                                seen.add(key);
                                blueskyPosts.push(info);
                            }
                        }
                    }

                    const cite = blockquote.getAttribute('cite');
                    if (cite && cite.includes('bsky')) {
                        const info = extractFromUrl(cite);
                        if (info) {
                            const key = `bsky-${info.did}-${info.rkey}`;
                            if (!seen.has(key)) {
                                seen.add(key);
                                blueskyPosts.push(info);
                            }
                        }
                    }
                });

                // M茅todo 4: Buscar en el HTML crudo - at:// URIs
                const atUriPattern = /data-bluesky-uri=["']at:\/\/(did:[^\/]+)\/app\.bsky\.feed\.post\/([^"'\s]+)["']/gi;
                let atMatch;
                while ((atMatch = atUriPattern.exec(html)) !== null) {
                    const info = {
                        url: `https://bsky.app/profile/${atMatch[1]}/post/${atMatch[2]}`,
                        did: atMatch[1],
                        rkey: atMatch[2]
                    };
                    const key = `bsky-${info.did}-${info.rkey}`;
                    if (!seen.has(key)) {
                        seen.add(key);
                        blueskyPosts.push(info);
                    }
                }

                // M茅todo 5: Buscar URLs de Bluesky en el HTML
                const blueskyUrlPattern = /https?:\/\/bsky\.app\/profile\/(did:[^\/\s"']+)\/post\/([^\s"'?&<>]+)/gi;
                let urlMatch;
                while ((urlMatch = blueskyUrlPattern.exec(html)) !== null) {
                    const info = {
                        url: urlMatch[0],
                        did: urlMatch[1],
                        rkey: urlMatch[2]
                    };
                    const key = `bsky-${info.did}-${info.rkey}`;
                    if (!seen.has(key)) {
                        seen.add(key);
                        blueskyPosts.push(info);
                    }
                }

                return blueskyPosts;
            }

            async fetchBlueskyVideos(blueskyPosts) {
                const videos = [];
                const apiEndpoint = 'https://public.api.bsky.app/xrpc/app.bsky.feed.getPostThread';

                for (const post of blueskyPosts) {
                    try {
                        const atUri = `at://${post.did}/app.bsky.feed.post/${post.rkey}`;
                        const apiUrl = `${apiEndpoint}?uri=${encodeURIComponent(atUri)}`;

                        const response = await fetch(apiUrl, {
                            signal: AbortSignal.timeout(10000)
                        });

                        if (!response.ok) continue;

                        const data = await response.json();
                        const postData = data.thread?.post;
                        if (!postData) continue;

                        const embed = postData.embed;
                        const record = postData.record;
                        const seenUrls = new Set();

                        const addVideo = (url, thumbnail = '') => {
                            const decodedUrl = decodeURIComponent(url);
                            if (!decodedUrl.includes('thumbnail.jpg') && !decodedUrl.includes('thumbnail.png')) {
                                if (!seenUrls.has(decodedUrl)) {
                                    seenUrls.add(decodedUrl);
                                    videos.push({
                                        type: decodedUrl.includes('.m3u8') ? 'Bluesky-HLS' : 'Bluesky-MP4',
                                        id: decodedUrl.split('/').pop().split('?')[0],
                                        embedUrl: decodedUrl,
                                        thumbnail: thumbnail ? decodeURIComponent(thumbnail) : '',
                                        isDirect: true
                                    });
                                }
                            }
                        };

                        // Extraer videos del embed
                        if (embed?.$type === 'app.bsky.embed.video#view' && embed.playlist) {
                            addVideo(embed.playlist, embed.thumbnail);
                        }

                        if (embed?.playlist) {
                            addVideo(embed.playlist, embed.thumbnail);
                        }

                        // Extraer del record.embed
                        if (record?.embed?.$type === 'app.bsky.embed.video' && record.embed.video?.ref?.$link) {
                            const playlistUrl = `https://video.bsky.app/watch/${post.did}/${record.embed.video.ref.$link}/playlist.m3u8`;
                            addVideo(playlistUrl);
                        }

                        if (embed?.video?.ref?.$link) {
                            const playlistUrl = `https://video.bsky.app/watch/${post.did}/${embed.video.ref.$link}/playlist.m3u8`;
                            addVideo(playlistUrl, embed.thumbnail);
                        }

                        // Buscar URLs de video en el JSON completo
                        const postJson = JSON.stringify(data);
                        const patterns = [
                            /https?:\/\/video\.bsky\.app\/watch\/[^"\s]+/gi,
                            /https?:\/\/cdn\.bsky\.app\/[^"\s]+\.mp4/gi,
                            /https?:\/\/[^"\s]+\.bsky\.app\/[^"\s]+\.m3u8/gi
                        ];

                        patterns.forEach(pattern => {
                            const matches = postJson.match(pattern);
                            if (matches) {
                                matches.forEach(url => addVideo(url, embed?.thumbnail));
                            }
                        });

                    } catch (error) {
                        // Continuar con el siguiente post si hay error
                        continue;
                    }
                }

                return videos;
            }

            detectTwitterVideos(html, doc, domain) {
                const tweets = [];
                const seen = new Set();

                // -----------------------------------------------------------------
                // MTODO 0: Buscar elementos AMP de Twitter (El Pa铆s y otros)
                // Este es el formato que usa El Pa铆s para embeber tweets
                // -----------------------------------------------------------------
                const ampTwitterElements = doc.querySelectorAll('amp-twitter, [data-tweetid]');

                ampTwitterElements.forEach(ampEl => {
                    const tweetId = ampEl.getAttribute('data-tweetid') || ampEl.getAttribute('data-tweet-id');

                    if (tweetId && tweetId.length > 5) {
                        const key = `twitter-${tweetId}`;

                        if (!seen.has(key)) {
                            seen.add(key);

                            // Intentar obtener el username si est谩 disponible
                            const username = ampEl.getAttribute('data-twitter-user') || 'twitter';

                            tweets.push({
                                type: 'Twitter',
                                id: tweetId,
                                username: username,
                                url: `https://twitter.com/${username}/status/${tweetId}`,
                                text: `Tweet de @${username}`,
                                context: '',
                                embedUrl: `https://platform.twitter.com/embed/Tweet.html?id=${tweetId}&theme=light&lang=es`
                            });
                        }
                    }
                });

                // -----------------------------------------------------------------
                // MTODO 1: Buscar blockquotes embebidos de Twitter
                // Este es el formato m谩s com煤n cuando los peri贸dicos embeben tweets
                // -----------------------------------------------------------------
                const twitterBlockquotes = doc.querySelectorAll('blockquote.twitter-tweet, blockquote[class*="twitter"]');

                twitterBlockquotes.forEach(bq => {
                    // El 煤ltimo <a> dentro del blockquote suele apuntar al tweet original
                    const links = bq.querySelectorAll('a[href*="twitter.com"], a[href*="x.com"]');
                    const tweetLink = links[links.length - 1]; // Tomar el 煤ltimo enlace

                    if (tweetLink) {
                        const href = tweetLink.href;
                        const tweetMatch = href.match(/(?:twitter\.com|x\.com)\/([^\/\?]+)\/status\/(\d+)/i);

                        if (tweetMatch) {
                            const username = tweetMatch[1];
                            const tweetId = tweetMatch[2];
                            const key = `twitter-${tweetId}`;

                            if (!seen.has(key)) {
                                seen.add(key);

                                // Extraer el texto del tweet (todo el texto dentro del blockquote menos el enlace final)
                                let tweetText = '';
                                const textNodes = [];

                                // Recorrer todos los nodos de texto y p谩rrafos del blockquote
                                bq.querySelectorAll('p').forEach(p => {
                                    const text = p.textContent.trim();
                                    if (text && !text.startsWith('') && !text.startsWith('http')) {
                                        textNodes.push(text);
                                    }
                                });

                                tweetText = textNodes.join(' ');

                                tweets.push({
                                    type: 'Twitter',
                                    id: tweetId,
                                    username: username,
                                    url: href,
                                    text: tweetText || `Tweet de @${username}`,
                                    context: tweetText.substring(0, 150),
                                    embedUrl: `https://platform.twitter.com/embed/Tweet.html?id=${tweetId}&theme=light&lang=es`
                                });
                            }
                        }
                    }
                });

                // -----------------------------------------------------------------
                // MTODO 2: Buscar enlaces directos de Twitter/X en el documento
                // -----------------------------------------------------------------
                const twitterLinks = doc.querySelectorAll('a[href*="twitter.com"], a[href*="x.com"]');

                twitterLinks.forEach(link => {
                    const href = link.href;

                    // Extraer el ID del tweet (formato: /usuario/status/1234567890)
                    const tweetMatch = href.match(/(?:twitter\.com|x\.com)\/([^\/\?]+)\/status\/(\d+)/i);

                    if (tweetMatch) {
                        const username = tweetMatch[1];
                        const tweetId = tweetMatch[2];
                        const key = `twitter-${tweetId}`;

                        if (!seen.has(key)) {
                            seen.add(key);
                            const linkText = link.textContent.trim();
                            const context = link.closest('p, div, article')?.textContent.substring(0, 150) || '';

                            tweets.push({
                                type: 'Twitter',
                                id: tweetId,
                                username: username,
                                url: href,
                                text: linkText || `Tweet de @${username}`,
                                context: context,
                                embedUrl: `https://platform.twitter.com/embed/Tweet.html?id=${tweetId}&theme=light&lang=es`
                            });
                        }
                    }
                });

                // -----------------------------------------------------------------
                // MTODO 3: Buscar enlaces en el HTML crudo por si acaso
                // -----------------------------------------------------------------
                const twitterUrlRegex = /https?:\/\/(?:twitter\.com|x\.com)\/([^\/\s"'\?]+)\/status\/(\d+)/gi;
                let match;
                while ((match = twitterUrlRegex.exec(html)) !== null) {
                    const username = match[1];
                    const tweetId = match[2];
                    const key = `twitter-${tweetId}`;

                    if (!seen.has(key)) {
                        seen.add(key);

                        tweets.push({
                            type: 'Twitter',
                            id: tweetId,
                            username: username,
                            url: match[0],
                            text: `Tweet de @${username}`,
                            context: '',
                            embedUrl: `https://platform.twitter.com/embed/Tweet.html?id=${tweetId}&theme=light&lang=es`
                        });
                    }
                }

                return tweets;
            }

            detectBrightcoveVideos(html, doc) {
                const videos = [];
                const seen = new Set();

                // M茅todo 1: Detectar desde data-attributes (ABC.es usa data-account, data-player, data-video-id)
                const elementsMethod1 = doc.querySelectorAll('[data-account][data-player][data-video-id]');

                elementsMethod1.forEach(el => {
                    const accountId = el.getAttribute('data-account');
                    const playerId = el.getAttribute('data-player');
                    const videoId = el.getAttribute('data-video-id');

                    if (accountId && playerId && videoId) {
                        const key = `bc-${videoId}`;
                        if (!seen.has(key)) {
                            seen.add(key);
                            const embedUrl = `https://players.brightcove.net/${accountId}/${playerId}_default/index.html?videoId=${videoId}`;
                            videos.push({
                                type: 'Brightcove',
                                id: videoId,
                                embedUrl: embedUrl
                            });
                        }
                    }
                });

                // M茅todo 2: Buscar elementos con data-video-id sueltos (con valores por defecto de ABC)
                const elementsMethod2 = doc.querySelectorAll('[data-video-id]');

                elementsMethod2.forEach(el => {
                    const videoId = el.getAttribute('data-video-id');
                    if (!videoId || videoId.length < 10) return;

                    const key = `bc-${videoId}`;
                    if (seen.has(key)) return;

                    // Buscar data-account y data-player en el mismo elemento o ancestros
                    let accountId = el.getAttribute('data-account');
                    let playerId = el.getAttribute('data-player');

                    if (!accountId || !playerId) {
                        let parent = el.parentElement;
                        let depth = 0;
                        while (parent && depth < 5) {
                            accountId = accountId || parent.getAttribute('data-account');
                            playerId = playerId || parent.getAttribute('data-player');
                            if (accountId && playerId) break;
                            parent = parent.parentElement;
                            depth++;
                        }
                    }

                    // Valores por defecto de ABC.es si no se encuentran
                    accountId = accountId || '55814260001';
                    playerId = playerId || 'rkDAq3Wf';

                    seen.add(key);
                    const embedUrl = `https://players.brightcove.net/${accountId}/${playerId}_default/index.html?videoId=${videoId}`;
                    videos.push({
                        type: 'Brightcove',
                        id: videoId,
                        embedUrl: embedUrl
                    });
                });

                // M茅todo 3: Detectar iframes de Brightcove
                const iframes = doc.querySelectorAll('iframe[src*="brightcove"]');

                iframes.forEach(iframe => {
                    const src = iframe.getAttribute('src') || '';
                    if (src && src.includes('brightcove.net')) {
                        const urlMatch = src.match(/players\.brightcove\.net\/(\d+)\/([^\/]+)\/[^?]*\?videoId=(\d+)/i);
                        if (urlMatch) {
                            const videoId = urlMatch[3];
                            const key = `bc-${videoId}`;
                            if (!seen.has(key)) {
                                seen.add(key);
                                videos.push({
                                    type: 'Brightcove',
                                    id: videoId,
                                    embedUrl: src
                                });
                            }
                        }
                    }
                });

                // M茅todo 4: Buscar URLs de Brightcove directamente en el HTML (para casos donde no hay atributos)
                const brightcoveUrlRegex = /https?:\/\/players\.brightcove\.net\/(\d+)\/([^\/\s"']+)\/[^?]*\?videoId=(\d+)/gi;
                let match;
                while ((match = brightcoveUrlRegex.exec(html)) !== null) {
                    const accountId = match[1];
                    const playerId = match[2];
                    const videoId = match[3];
                    const embedUrl = match[0];
                    const key = `bc-${videoId}`;

                    if (!seen.has(key)) {
                        seen.add(key);
                        videos.push({
                            type: 'Brightcove',
                            id: videoId,
                            embedUrl: embedUrl
                        });
                    }
                }

                return videos;
            }

            async extractArticleContent(html, url) {
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const domain = new URL(url).hostname.replace('www.', '');

                const config = this.siteConfigs[domain] || {
                    title: 'h1, .title, .headline, .article-title',
                    content: 'article, .article, .content, .post-content, .entry-content, .article-body, .story-body',
                    author: '.author, .byline, .writer',
                    images: 'article img, .article img, .content img',
                    exclude: '.ad, .advertisement, .publicidad, .banner'
                };

                // PRIMERO: Detectar videos Y TWEETS ANTES de eliminar cualquier elemento
                const dailymotionVideos = this.detectDailymotionVideos(html);
                const brightcoveVideos = this.detectBrightcoveVideos(html, doc);
                const elPaisVideos = domain === 'elpais.com' ? this.detectElPaisVideos(html, doc) : [];
                const twitterVideos = this.detectTwitterVideos(html, doc, domain);

                // Detectar posts de Bluesky embebidos
                const blueskyPosts = this.detectBlueskyVideos(html, doc);
                let blueskyVideos = [];
                if (blueskyPosts.length > 0) {
                    try {
                        blueskyVideos = await this.fetchBlueskyVideos(blueskyPosts);
                    } catch (error) {
                        // Si hay error al obtener videos de Bluesky, continuar sin ellos
                    }
                }

                const videos = [...elPaisVideos, ...dailymotionVideos, ...brightcoveVideos, ...blueskyVideos];

                // SEGUNDO: Extraer im谩genes, autor Y CONTENIDO ADICIONAL ANTES de eliminar elementos
                const images = this.extractImages(doc, config, url);
                const authorImage = this.extractAuthorImage(doc, domain, url);
                
                // Extraer datos adicionales (res煤menes, standfirst, etc.) ANTES de eliminar elementos
                const { footerSummary, subtitleLink, subtitleLinkText } = this.extractAdditionalContent(doc, domain, url);

                // TERCERO: Ahora eliminar elementos excluidos (incluyendo contenedores de video)
                if (config.exclude) {
                    doc.querySelectorAll(config.exclude).forEach(el => el.remove());
                }

                // Eliminar tambi茅n contenedores de video de ABC despu茅s de extraer los datos
                if (domain === 'abc.es') {
                    doc.querySelectorAll('.video, .nibara-element').forEach(el => el.remove());
                }

                // Eliminar elementos AMP de Twitter (El Pa铆s y otros) despu茅s de extraer los datos
                doc.querySelectorAll('amp-twitter, [data-tweetid], .a_em').forEach(el => el.remove());

                const title = this.extractTextContent(doc, config.title);
                const author = this.extractAuthor(doc, config, domain);

                // Ahora eliminar el c-header para que no aparezca en el contenido del texto
                const cHeaderToRemove = doc.querySelector('.c-header');
                if (cHeaderToRemove) {
                    cHeaderToRemove.remove();
                }

                const { text, publishDate, updateDate } = this.extractContent(doc, config, domain, url);
                const links = this.extractLinks(doc, domain);

                // Extraer resumen del meta description si est谩 disponible
                let metaDescription = '';
                const metaDescElement = doc.querySelector('meta[name="description"]');
                if (metaDescElement && metaDescElement.getAttribute('content')) {
                    metaDescription = this.cleanText(metaDescElement.getAttribute('content'));
                }

                const wordCount = text.replace(/<[^>]*>/g, '').split(/\s+/).length;
                const readingTime = Math.ceil(wordCount / 200);

                return {
                    title: title,
                    author: author,
                    authorImage: authorImage,
                    text: text,
                    publishDate: publishDate,
                    updateDate: updateDate,
                    footerSummary: footerSummary,
                    metaDescription: metaDescription,
                    subtitleLink: subtitleLink,
                    subtitleLinkText: subtitleLinkText,
                    images: images.slice(0, 5),
                    links: links.slice(0, 10),
                    videos: videos,
                    tweets: twitterVideos,
                    stats: {
                        wordCount: wordCount,
                        readingTime: readingTime,
                        imageCount: images.length,
                        domain: domain
                    }
                };
            }

            extractTextContent(doc, selector) {
                // Probar m煤ltiples selectores si est谩n separados por coma
                const selectors = selector.split(',').map(s => s.trim());

                for (const sel of selectors) {
                    const element = doc.querySelector(sel);
                    if (element) {
                        if (element.textContent && element.textContent.trim()) {
                            const title = this.cleanText(element.textContent);

                            // Para eldiario.es, ser menos restrictivo con los filtros
                            if (title.length < 5) {
                                continue;
                            }

                            // Solo rechazar "煤ltima hora" si es exactamente eso
                            if (title.toLowerCase().trim() === '煤ltima hora' ||
                                title.toLowerCase().trim() === 'breaking' ||
                                title.toLowerCase().trim() === 'directo' ||
                                title.toLowerCase().trim() === 'en vivo') {
                                continue;
                            }

                            return title;
                        }
                    }
                }

                // Si no encontramos t铆tulo con los selectores, intentar extraer del <title> tag
                const titleElement = doc.querySelector('title');
                if (titleElement && titleElement.textContent && titleElement.textContent.trim()) {
                    const titleFromHead = this.cleanText(titleElement.textContent);

                    // Verificar que no sea un t铆tulo gen茅rico
                    if (titleFromHead.length > 10 &&
                        !titleFromHead.toLowerCase().includes('eldiario.es') &&
                        !titleFromHead.toLowerCase().includes('煤ltima hora')) {
                        return titleFromHead;
                    }
                }

                return '';
            }

            // =====================================================================
            // EXTRACCIN DE AUTOR POR PERIDICO
            // =====================================================================
            extractAuthor(doc, config, domain) {
                // -----------------------------------------------------------------
                // ELDIARIO.ES
                // Busca el autor en enlaces espec铆ficos dentro de .authors
                // -----------------------------------------------------------------
                if (domain === 'eldiario.es') {
                    const authorLink = doc.querySelector('.authors a, .info-wrapper .authors a');
                    if (authorLink && authorLink.textContent.trim()) {
                        return this.cleanText(authorLink.textContent);
                    }
                }

                // -----------------------------------------------------------------
                // EL PAS
                // Busca el autor en varios selectores espec铆ficos
                // -----------------------------------------------------------------
                if (domain === 'elpais.com') {
                    const authorEl = doc.querySelector('.a_md_a_n, .ev-author, .a_md_a');
                    if (authorEl && authorEl.textContent.trim()) {
                        return this.cleanText(authorEl.textContent);
                    }
                }

                // -----------------------------------------------------------------
                // PERIDICOS GENRICOS O NO CONFIGURADOS
                // Usa el selector de la configuraci贸n general
                // -----------------------------------------------------------------
                const authorEl = doc.querySelector(config.author);
                return authorEl ? this.cleanText(authorEl.textContent) : 'Autor no disponible';
            }

            // =====================================================================
            // EXTRACCIN DE IMAGEN DEL AUTOR POR PERIDICO
            // =====================================================================
            extractAuthorImage(doc, domain, url) {
                // -----------------------------------------------------------------
                // ABC
                // Extrae la foto del autor desde .voc-author__image img
                // -----------------------------------------------------------------
                if (domain === 'abc.es') {
                    const authorImageEl = doc.querySelector('.voc-author__image img');
                    if (authorImageEl) {
                        let src = authorImageEl.src || authorImageEl.getAttribute('data-src') || authorImageEl.getAttribute('data-lazy-src');
                        if (src && !src.includes('data:image') && src.length > 10) {
                            if (src.startsWith('/')) {
                                src = new URL(url).origin + src;
                            }
                            return src;
                        }
                    }
                }

                // -----------------------------------------------------------------
                // EL PAS
                // Extrae la foto del autor desde .a_md_i img o amp-img
                // -----------------------------------------------------------------
                if (domain === 'elpais.com') {
                    const authorImageEl = doc.querySelector('.a_md_i img, .a_md_i amp-img, figure.a_md_i img, figure.a_md_i amp-img');
                    if (authorImageEl) {
                        let src = authorImageEl.src ||
                                  authorImageEl.getAttribute('src') ||
                                  authorImageEl.getAttribute('data-src') ||
                                  authorImageEl.getAttribute('data-lazy-src') ||
                                  authorImageEl.getAttribute('srcset')?.split(',')[0]?.trim()?.split(' ')[0];

                        if (src && !src.includes('data:image') && src.length > 10) {
                            if (src.startsWith('/')) {
                                src = new URL(url).origin + src;
                            }

                            // Optimizar URL de El Pa铆s
                            if (src.includes('?')) {
                                const urlObj = new URL(src);
                                urlObj.searchParams.delete('width');
                                urlObj.searchParams.delete('height');
                                urlObj.searchParams.delete('w');
                                urlObj.searchParams.delete('h');
                                if (src.includes('resizer/v2/')) {
                                    urlObj.searchParams.set('width', '400');
                                }
                                src = urlObj.toString();
                            }

                            return src;
                        }
                    }
                }

                // -----------------------------------------------------------------
                // ELDIARIO.ES
                // Extrae la foto del autor desde .title--with-author__avatar
                // -----------------------------------------------------------------
                if (domain === 'eldiario.es') {
                    // Ruta exacta: .title--with-author__avatar > .ni-figure > a > picture.news-image > img.lazy
                    const authorImageEl = doc.querySelector('.title--with-author__avatar .ni-figure picture.news-image img.lazy') ||
                                         doc.querySelector('.title--with-author__avatar picture.news-image img') ||
                                         doc.querySelector('.title--with-author__avatar .ni-figure img') ||
                                         doc.querySelector('.title--with-author__avatar img');

                    if (authorImageEl) {
                        // Priorizar data-src para im谩genes lazy
                        let src = authorImageEl.getAttribute('data-src') ||
                                  authorImageEl.getAttribute('src') ||
                                  authorImageEl.getAttribute('data-lazy-src');

                        // Si no hay src directamente, buscar en picture > source
                        if (!src || src.includes('data:image')) {
                            const pictureEl = authorImageEl.closest('picture');
                            if (pictureEl) {
                                const sources = pictureEl.querySelectorAll('source');
                                if (sources.length > 0) {
                                    // Intentar con cada source
                                    for (const source of sources) {
                                        const srcset = source.getAttribute('srcset') ||
                                                      source.getAttribute('data-srcset') ||
                                                      source.getAttribute('data-src');
                                        if (srcset) {
                                            src = srcset.split(',')[0].trim().split(' ')[0];
                                            if (src && !src.includes('data:image')) {
                                                break;
                                            }
                                        }
                                    }
                                }
                            }
                        }

                        if (src && !src.includes('data:image') && src.length > 10) {
                            // Convertir a URL absoluta si es necesaria
                            if (src.startsWith('/')) {
                                src = new URL(url).origin + src;
                            }

                            // Optimizar URL de eldiario.es - eliminar par谩metros de redimensionamiento
                            if (src.includes('?')) {
                                const urlObj = new URL(src);
                                urlObj.searchParams.delete('width');
                                urlObj.searchParams.delete('height');
                                urlObj.searchParams.delete('w');
                                urlObj.searchParams.delete('h');
                                urlObj.searchParams.delete('resize');
                                urlObj.searchParams.delete('quality');
                                src = urlObj.toString();
                            }

                            return src;
                        }
                    }
                }

                // -----------------------------------------------------------------
                // EL MUNDO
                // Extrae la foto del autor desde JSON-LD schema.org
                // El JSON-LD puede tener: NewsArticle > author > Person > image
                // -----------------------------------------------------------------
                if (domain === 'elmundo.es') {
                    const jsonLdScripts = doc.querySelectorAll('script[type="application/ld+json"]');
                    
                    for (const script of jsonLdScripts) {
                        try {
                            const jsonData = JSON.parse(script.textContent);
                            
                            // Buscar en el nivel superior
                            if (jsonData['@type'] === 'Person' && jsonData.image) {
                                return jsonData.image;
                            }
                            
                            // Buscar dentro de NewsArticle > author
                            if ((jsonData['@type'] === 'NewsArticle' || 
                                 jsonData['@type'] === 'ReportageNewsArticle' ||
                                 (Array.isArray(jsonData['@type']) && 
                                  (jsonData['@type'].includes('NewsArticle') || jsonData['@type'].includes('ReportageNewsArticle')))) 
                                && jsonData.author) {
                                
                                // author puede ser un objeto o un array
                                const authors = Array.isArray(jsonData.author) ? jsonData.author : [jsonData.author];
                                
                                for (const author of authors) {
                                    if (author['@type'] === 'Person' && author.image) {
                                        return author.image;
                                    }
                                }
                            }
                        } catch (e) {
                            continue;
                        }
                    }
                }

                // -----------------------------------------------------------------
                // OTROS PERIDICOS
                // Por defecto, no se extrae imagen del autor
                // -----------------------------------------------------------------
                return '';
            }

            // =====================================================================
            // EXTRACCIN DE CONTENIDO Y FECHAS POR PERIDICO
            // =====================================================================
            extractContent(doc, config, domain, url) {
                let text = '';
                let publishDate = '';
                let updateDate = '';

                // -----------------------------------------------------------------
                // ELDIARIO.ES
                // Extrae fechas desde meta tags y elementos time
                // -----------------------------------------------------------------
                if (domain === 'eldiario.es') {
                    publishDate = this.extractDateFromMeta(doc, [
                        "meta[property='article:published_time']",
                        "time[datetime]"
                    ]);

                    updateDate = this.extractDateFromMeta(doc, [
                        "meta[property='article:modified_time']",
                        "time[itemprop='dateModified']",
                        "time.modification-date[datetime]"
                    ]);
                }

                // -----------------------------------------------------------------
                // EL PAS
                // Extrae fechas desde meta tags y elementos espec铆ficos
                // -----------------------------------------------------------------
                if (domain === 'elpais.com') {
                    publishDate = this.extractDateFromMeta(doc, [
                        "meta[property='article:published_time']",
                        "meta[name='article:published_time']",
                        "time[datetime]",
                        ".ev-date[datetime]",
                        ".a_md_f time"
                    ]);

                    updateDate = this.extractDateFromMeta(doc, [
                        "meta[property='article:modified_time']",
                        "meta[name='article:modified_time']",
                        ".ev-date-updated[datetime]",
                        "time[itemprop='dateModified']"
                    ]);
                }

                // -----------------------------------------------------------------
                // ABC
                // Extrae fechas desde meta tags y .voc-author__time
                // -----------------------------------------------------------------
                if (domain === 'abc.es') {
                    publishDate = this.extractDateFromMeta(doc, [
                        "meta[property='article:published_time']",
                        "meta[name='article:published_time']",
                        "time[datetime]",
                        ".voc-author__time time"
                    ]);

                    updateDate = this.extractDateFromMeta(doc, [
                        "meta[property='article:modified_time']",
                        "meta[name='article:modified_time']",
                        "time[itemprop='dateModified']"
                    ]);

                    // Si no se encontr贸 la fecha de actualizaci贸n en meta tags, buscar en el texto del time strong
                    if (!updateDate) {
                        const timeElement = doc.querySelector('.voc-author__time time strong');
                        if (timeElement && timeElement.textContent) {
                            const updateText = this.cleanText(timeElement.textContent);
                            // Formato: "Actualizado a las 19:31h."
                            if (updateText.toLowerCase().includes('actualizado')) {
                                updateDate = updateText;
                            }
                        }
                    }
                }

                // -----------------------------------------------------------------
                // EL MUNDO
                // Extrae fechas desde meta tags y .ue-c-article__publishdate
                // Estructura: .ue-c-article__bar-footer > .ue-c-article__publishdate > time > span
                // -----------------------------------------------------------------
                if (domain === 'elmundo.es') {
                    // Intentar desde meta tags primero
                    publishDate = this.extractDateFromMeta(doc, [
                        "meta[property='article:published_time']",
                        "meta[name='article:published_time']",
                        "time[datetime]"
                    ]);

                    updateDate = this.extractDateFromMeta(doc, [
                        "meta[property='article:modified_time']",
                        "meta[name='article:modified_time']"
                    ]);

                    // Si no se encuentra en meta tags, extraer desde el elemento visual
                    if (!publishDate || !updateDate) {
                        const publishDateContainer = doc.querySelector('.ue-c-article__bar-footer .ue-c-article__publishdate');
                        if (publishDateContainer) {
                            const timeElement = publishDateContainer.querySelector('time');
                            if (timeElement) {
                                // Extraer el texto completo del time (incluye fecha y hora)
                                let fullText = '';
                                const timeTextNode = timeElement.childNodes[0]; // Texto antes del span
                                if (timeTextNode && timeTextNode.nodeType === 3) {
                                    fullText = timeTextNode.textContent.trim();
                                }
                                
                                // Extraer la hora del span dentro del time
                                const hourSpan = timeElement.querySelector('span');
                                const hour = hourSpan ? this.cleanText(hourSpan.textContent) : '';
                                
                                // Combinar fecha y hora
                                if (fullText && hour) {
                                    // Eliminar el guion final si existe
                                    fullText = fullText.replace(/\s*-\s*$/, '').trim();
                                    const fullDateTime = `${fullText} ${hour}`;
                                    
                                    // Verificar si contiene "Actualizado"
                                    const label = publishDateContainer.textContent;
                                    if (label.toLowerCase().includes('actualizado')) {
                                        updateDate = fullDateTime;
                                    } else {
                                        publishDate = fullDateTime;
                                    }
                                }
                            }
                        }
                    }
                }

                // Para El Pa铆s, buscar espec铆ficamente el contenedor a_c clearfix
                let contentEl;
                if (domain === 'elpais.com') {
                    contentEl = doc.querySelector('.a_c.clearfix');
                }

                // Si no se encuentra el contenedor espec铆fico, usar la configuraci贸n general
                if (!contentEl) {
                    contentEl = doc.querySelector(config.content);
                }

                if (contentEl) {

                    // -----------------------------------------------------------------
                    // ELEMENTOS COMUNES A ELIMINAR (todos los peri贸dicos)
                    // -----------------------------------------------------------------
                    const elementsToRemove = [
                        'script', 'style', 'noscript',
                        '.ad', '.advertisement', '.publicidad',
                        '.edi-social-buttons', '.shareIcons', '.comments',
                        '.recirculation-area', '.addoor-widget'
                    ];

                    // -----------------------------------------------------------------
                    // EL PAS - Elementos espec铆ficos a eliminar
                    // Incluye: ads espec铆ficos, widgets, redes sociales, outbrain, taboola
                    // -----------------------------------------------------------------
                    if (domain === 'elpais.com') {
                        const elPaisRemove = [
                            '.ad-giga', '.ad-ldb', '.ad-mldb', '.ad-mpu', '.ad-nstd-bd',
                            '.w_rs', '.a_com', '.me-dis', '.me_f', '.w-rel',
                            '.outbrain', '.obne_ob', '.obne_ne', '.taboola',
                            '.ev-unit-twitter', '.x-ph', '.x_bh', '.z-fo', '.z-he'
                        ];
                        elementsToRemove.push(...elPaisRemove);
                    }

                    // -----------------------------------------------------------------
                    // ABC - Elementos espec铆ficos a eliminar
                    // Incluye: headers, ads, social, comments, paywall, t铆tulos duplicados
                    // -----------------------------------------------------------------
                    if (domain === 'abc.es') {
                        const abcRemove = [
                            '.voc-header', '.voc-header-news', '.voc-advertising', '.voc-breadcrumbs',
                            '.voc-social', '.voc-share-social', '.voc-save-news', '.voc-login-box',
                            '.voc-comments-panel', '.voc-see-comments', '.voc-author__social',
                            '.voc-d-c-related-news', '.voc-most-read', '.voc-ob-wrapper',
                            '.voc-ints', '.voc-ints__l', '.voc-ints__i', '.voc-cope-mod', '.voc-discounts', '.voc-swiss',
                            '.paywall2', '.voc-premium', '.voc-onplus', '.voc-btn__container',
                            '#disqus_thread', '#comments-container', '#open-comments',
                            '.voc-footer', '.voc-progress', '.voc-bm', '.voc-topics',
                            '.voc-subtitle', '.voc-lead', '.voc-summary', '.voc-entradilla', '.voc-intro',
                            'h1', '.voc-title',
                            'aside', '.voc-grid__col', '.voc-grid__col--sticky-adver'
                        ];
                        elementsToRemove.push(...abcRemove);
                    }

                    // Aplicar eliminaciones
                    elementsToRemove.forEach(selector => {
                        contentEl.querySelectorAll(selector).forEach(el => el.remove());
                    });

                    // PROCESAR KNOW-MORE ANTES de extraer p谩rrafos individuales
                    let fullHTML = contentEl.innerHTML;

                    // Convertir elementos know-more en formato de 2 columnas
                    fullHTML = fullHTML.replace(
                        /<aside\s+class="know-more know-more--with-image"[^>]*>[\s\S]*?<\/aside>/gi,
                        (match) => {
                            // Extraer URL
                            const urlMatch = match.match(/href\s*=\s*["']([^"']+)["']/i);
                            const url = urlMatch ? urlMatch[1] : '';

                            // Extraer t铆tulo
                            const titleMatch = match.match(/<p\s+class="know-more__title"[^>]*>([^<]+)<\/p>/i);
                            const title = titleMatch ? titleMatch[1] : '';

                            // Extraer contenido de picture
                            const pictureMatch = match.match(/<picture\s+class="know-more__img"[^>]*>([\s\S]*?)<\/picture>/i);
                            const pictureContent = pictureMatch ? pictureMatch[1] : '';

                            if (!url || !title) {
                                return match;
                            }

                            // Verificar que la URL sea v谩lida
                            if (url.length < 10 || (!url.startsWith('http') && !url.startsWith('/'))) {
                                return match;
                            }

                            // Extraer imagen - buscar data-src primero, luego src
                            let imgTag = '';
                            const imgMatch = pictureContent.match(/<img[^>]+>/i);
                            if (imgMatch) {
                                let imgElement = imgMatch[0];

                                // Si tiene data-src, convertir a src
                                const dataSrcMatch = imgElement.match(/data-src\s*=\s*["']([^"']+)["']/i);
                                if (dataSrcMatch) {
                                    const realSrc = dataSrcMatch[1];
                                    imgTag = `<img src="${realSrc}" alt="${title}" />`;
                                } else {
                                    imgTag = imgElement;
                                }
                            } else {
                                // Fallback a source
                                const sourceMatch = pictureContent.match(/<source[^>]+srcset\s*=\s*["']([^"']+)["'][^>]*>/i);
                                if (sourceMatch) {
                                    const srcUrl = sourceMatch[1].split(' ')[0];
                                    imgTag = `<img src="${srcUrl}" alt="${title}" />`;
                                }
                            }

                            // Escapar tanto comillas simples como dobles
                            const safeTitle = title.replace(/'/g, "\\'").replace(/"/g, "&quot;");
                            return `
                                <div class="know-more-container">
                                    <div class="know-more-text">
                                        <a href="javascript:void(0)" onclick="window.newsSearcher.loadModalContent('${url}', '${safeTitle}')" class="know-more-title">${title}</a>
                                    </div>
                                    <div class="know-more-image">
                                        ${imgTag}
                                    </div>
                                </div>
                            `;
                        }
                    );

                    // Actualizar el innerHTML con los know-more procesados
                    contentEl.innerHTML = fullHTML;

                    // -----------------------------------------------------------------
                    // SELECTORES DE CONTENIDO POR PERIDICO
                    // Define qu茅 elementos de texto extraer del contenido principal
                    // -----------------------------------------------------------------
                    let contentSelector = 'p, h2, h3, h4, h5, h6, blockquote, ul, ol, .article-text p, h2.article-text, .know-more-container';

                    // EL PAS - Selectores espec铆ficos
                    if (domain === 'elpais.com') {
                        contentSelector = 'p, h2, h3, h4, h5, h6, blockquote, ul, ol, ' +
                            '.a_st, .ev-title, .ev-text, .lk, .ev-kicker, ' +
                            '.know-more-container, figure.a_m, ' +
                            'figure.a_m-h, .prisa_ad figure';
                    }

                    // ELDIARIO.ES - Selectores espec铆ficos incluyendo figuras
                    if (domain === 'eldiario.es') {
                        contentSelector = 'p, h2, h3, h4, h5, h6, blockquote, ul, ol, ' +
                            '.article-text p, h2.article-text, .know-more-container, ' +
                            'figure.ni-figure, figure.news-image, figure';
                    }

                    // ABC - Selectores espec铆ficos
                    if (domain === 'abc.es') {
                        contentSelector = 'p, h2, h3, h4, h5, h6, blockquote, ul, ol, .voc-p, .voc-title, .voc-subtitle';
                    }

                    const contentElements = contentEl.querySelectorAll(contentSelector);
                    const textParts = [];

                    contentElements.forEach(el => {
                        const tagName = el.tagName.toLowerCase();

                        // Las figuras se procesan sin importar el texto
                        if (tagName === 'figure') {
                            // EXCLUIR figuras de autor (El Pa铆s usa .a_md_i para imagen del autor)
                            if (domain === 'elpais.com' && el.classList.contains('a_md_i')) {
                                return; // Saltar esta figura (es la imagen del autor)
                            }

                            // Procesar figuras con im谩genes (El Pa铆s y eldiario.es)
                            let imgEl = el.querySelector('img, amp-img');

                            // Si no hay img directamente, buscar en picture > source o picture > img
                            if (!imgEl && domain === 'eldiario.es') {
                                const picture = el.querySelector('picture');
                                if (picture) {
                                    imgEl = picture.querySelector('img');
                                }
                            }

                            if (imgEl) {
                                let imgSrc = null;

                                // Para eldiario.es, priorizar source srcset del picture
                                if (domain === 'eldiario.es') {
                                    const picture = imgEl.closest('picture');
                                    if (picture) {
                                        const sources = picture.querySelectorAll('source');
                                        if (sources.length > 0) {
                                            const firstSource = sources[0];
                                            const srcset = firstSource.getAttribute('srcset') || firstSource.getAttribute('data-srcset');
                                            if (srcset) {
                                                imgSrc = srcset.split(',')[0].trim().split(' ')[0];
                                            }
                                        }
                                    }
                                }

                                // Si no se encontr贸 en source, buscar en el img
                                if (!imgSrc) {
                                    imgSrc = imgEl.getAttribute('src') ||
                                            imgEl.getAttribute('data-src') ||
                                            imgEl.getAttribute('data-lazy-src') ||
                                            imgEl.getAttribute('data-srcset') ||
                                            imgEl.getAttribute('srcset')?.split(',')[0]?.trim()?.split(' ')[0];
                                }

                                if (imgSrc && imgSrc.length > 10 && !imgSrc.includes('data:image')) {
                                    // Convertir a URL absoluta si es necesaria
                                    if (imgSrc.startsWith('/')) {
                                        imgSrc = new URL(url).origin + imgSrc;
                                    }

                                    // Optimizar URL de El Pa铆s
                                    if (domain === 'elpais.com' && imgSrc.includes('?')) {
                                        const urlObj = new URL(imgSrc);
                                        urlObj.searchParams.delete('width');
                                        urlObj.searchParams.delete('height');
                                        urlObj.searchParams.delete('w');
                                        urlObj.searchParams.delete('h');
                                        if (imgSrc.includes('resizer/v2/')) {
                                            urlObj.searchParams.set('width', '1200');
                                        }
                                        imgSrc = urlObj.toString();
                                    }

                                    // Optimizar URL de eldiario.es
                                    if (domain === 'eldiario.es' && imgSrc.includes('?')) {
                                        const urlObj = new URL(imgSrc);
                                        urlObj.searchParams.delete('width');
                                        urlObj.searchParams.delete('height');
                                        urlObj.searchParams.delete('w');
                                        urlObj.searchParams.delete('h');
                                        urlObj.searchParams.delete('resize');
                                        urlObj.searchParams.delete('quality');
                                        imgSrc = urlObj.toString();
                                    }

                                    // Extraer pie de foto
                                    const figcaptionEl = el.querySelector('figcaption');
                                    let captionHTML = '';
                                    if (figcaptionEl) {
                                        captionHTML = `<div class="modal-image-caption">${figcaptionEl.textContent.trim()}</div>`;
                                    }

                                    textParts.push(`<img src="${imgSrc}" class="modal-image" style="max-width: 100%; height: auto; margin: 20px 0; border-radius: 8px;" onerror="this.style.display='none'">${captionHTML}`);
                                }
                            }
                            return; // Saltar al siguiente elemento
                        }

                        // Para el resto de elementos, verificar longitud de texto
                        const cleanText = this.cleanText(el.textContent);
                        if (cleanText.length > 15) {
                            let htmlContent = el.innerHTML; // Preservar HTML incluyendo enlaces

                            // Solo procesar enlaces normales (know-more ya se proces贸 arriba)
                            htmlContent = htmlContent.replace(/<a\s+([^>]*?)href\s*=\s*["']([^"']+)["']([^>]*?)>([^<]+)<\/a>/gi,
                                (match, beforeHref, url, afterHref, linkText) => {
                                    // Escapar tanto comillas simples como dobles en el texto del enlace
                                    const safeText = linkText.replace(/'/g, "\\'").replace(/"/g, "&quot;");
                                    return `<a href="javascript:void(0)" onclick="window.newsSearcher.loadModalContent('${url}', '${safeText}')">${linkText}</a>`;
                                });

                            if (tagName === 'div' && el.classList.contains('know-more-container')) {
                                // Los know-more-container se a帽aden tal como est谩n
                                textParts.push(el.outerHTML);
                            } else if (tagName.startsWith('h')) {
                                // Preservar las clases de los elementos h
                                const className = el.className ? ` class="${el.className}"` : '';
                                textParts.push(`<${tagName}${className}>${htmlContent}</${tagName}>`);
                            } else if (tagName === 'blockquote') {
                                textParts.push(`<blockquote>${htmlContent}</blockquote>`);
                            } else if (tagName === 'ul' || tagName === 'ol') {
                                textParts.push(`<${tagName}>${htmlContent}</${tagName}>`);
                            } else {
                                textParts.push(`<p>${htmlContent}</p>`);
                            }
                        }
                    });

                    text = textParts.join('\n\n');
                }

                if (!text && domain === 'eldiario.es') {
                    const fallbackContent = doc.querySelector('.c-content, .content__wrapper');
                    if (fallbackContent) {
                        const paragraphs = fallbackContent.querySelectorAll('p');
                        const textParts = [];
                        paragraphs.forEach(p => {
                            const cleanText = this.cleanText(p.textContent);
                            if (cleanText.length > 20) {
                                let htmlContent = p.innerHTML; // Preservar HTML incluyendo enlaces

                                // Convertir elementos know-more en formato de 2 columnas
                                htmlContent = htmlContent.replace(
                                    /<aside\s+class="know-more[^"]*"[^>]*>[\s\S]*?<a\s+[^>]*href\s*=\s*["']([^"']+)["'][^>]*>[\s\S]*?<p\s+class="know-more__title"[^>]*>([^<]+)<\/p>[\s\S]*?<picture\s+class="know-more__img"[^>]*>([\s\S]*?)<\/picture>[\s\S]*?<\/a>[\s\S]*?<\/aside>/gi,
                                    (match, url, title, pictureContent) => {
                                        // Extraer la imagen del contenido de picture - buscar img tag
                                        let imgTag = '';
                                        const imgMatch = pictureContent.match(/<img[^>]+>/i);
                                        if (imgMatch) {
                                            imgTag = imgMatch[0];
                                        } else {
                                            // Si no hay img, buscar src en source tags
                                            const sourceMatch = pictureContent.match(/<source[^>]+srcset\s*=\s*["']([^"']+)["'][^>]*>/i);
                                            if (sourceMatch) {
                                                const srcUrl = sourceMatch[1].split(' ')[0]; // Tomar la primera URL del srcset
                                                imgTag = `<img src="${srcUrl}" alt="${title}" />`;
                                            }
                                        }

                                        const safeTitle = title.replace(/'/g, "\\'");
                                        return `
                                            <div class="know-more-container">
                                                <div class="know-more-text">
                                                    <a href="javascript:void(0)" onclick="window.newsSearcher.loadModalContent('${url}', '${safeTitle}')" class="know-more-title">${title}</a>
                                                </div>
                                                <div class="know-more-image">
                                                    ${imgTag}
                                                </div>
                                            </div>
                                        `;
                                    }
                                );

                                // Convertir enlaces normales para que se abran en la modal
                                htmlContent = htmlContent.replace(/<a\s+([^>]*?)href\s*=\s*["']([^"']+)["']([^>]*?)>([^<]+)<\/a>/gi,
                                    (match, beforeHref, url, afterHref, linkText) => {
                                        // Escapar comillas simples en el texto del enlace
                                        const safeText = linkText.replace(/'/g, "\\'");
                                        return `<a href="javascript:void(0)" onclick="window.newsSearcher.loadModalContent('${url}', '${safeText}')">${linkText}</a>`;
                                    });

                                textParts.push(`<p>${htmlContent}</p>`);
                            }
                        });
                        text = textParts.join('\n\n');
                    }
                }

                return { text, publishDate, updateDate };
            }

            extractDateFromMeta(doc, selectors) {
                for (const selector of selectors) {
                    const element = doc.querySelector(selector);
                    if (element) {
                        const dateValue = element.getAttribute('content') || element.getAttribute('datetime');
                        if (dateValue) {
                            return this.formatDateToDDMMYYYY(dateValue);
                        }
                    }
                }
                return '';
            }

            // =====================================================================
            // EXTRACCIN DE IMGENES POR PERIDICO
            // =====================================================================
            extractImages(doc, config, url) {
                const images = [];
                const domain = new URL(url).hostname.replace('www.', '');
                const imageElements = doc.querySelectorAll(config.images);

                imageElements.forEach((img, index) => {
                    let src = img.src || img.getAttribute('data-src') || img.getAttribute('data-lazy-src');

                    // Para elementos amp-img, extraer src de sus atributos espec铆ficos
                    if (img.tagName.toLowerCase() === 'amp-img') {
                        src = img.getAttribute('src') ||
                              img.getAttribute('data-src') ||
                              img.getAttribute('data-lazy-src') ||
                              img.getAttribute('srcset')?.split(',')[0]?.trim()?.split(' ')[0];
                    }

                    // Si no hay src, intentar extraer de srcset o data-srcset (com煤n en picture elements)
                    if (!src || src.length < 10) {
                        const srcset = img.getAttribute('srcset') || img.getAttribute('data-srcset');
                        if (srcset) {
                            // Extraer la primera URL del srcset
                            const firstUrl = srcset.split(',')[0].trim().split(' ')[0];
                            if (firstUrl && firstUrl.length > 10) {
                                src = firstUrl;
                            }
                        }
                    }

                    // -----------------------------------------------------------------
                    // EL PAS - Filtrar im谩genes dentro de contenedores excluidos
                    // Verificar si la imagen est谩 dentro de cualquier elemento de la lista exclude
                    // -----------------------------------------------------------------
                    if (domain === 'elpais.com' && config.exclude) {
                        // Obtener los selectores de exclusi贸n como array
                        const excludeSelectors = config.exclude.split(',').map(s => s.trim());

                        // Verificar si la imagen est谩 dentro de alg煤n contenedor excluido
                        let isInExcludedContainer = false;
                        for (const selector of excludeSelectors) {
                            if (img.closest(selector)) {
                                isInExcludedContainer = true;
                                break;
                            }
                        }

                        if (isInExcludedContainer) {
                            return; // Saltar esta imagen
                        }
                    }

                    // -----------------------------------------------------------------
                    // ABC - Filtrar im谩genes dentro de contenedores no deseados
                    // Excluir: <aside> o .voc-grid__col--sticky-adver
                    // NO excluir: <div class="voc-grid__col"> (contiene el art铆culo)
                    // -----------------------------------------------------------------
                    if (domain === 'abc.es') {
                        const isInAside = img.closest('aside');
                        const isInStickyAdver = img.closest('.voc-grid__col--sticky-adver');

                        // Excluir si est谩 dentro de <aside> o si tiene la clase sticky-adver
                        if (isInAside || isInStickyAdver) {
                            return; // Saltar esta imagen
                        }
                    }

                    if (src && !src.includes('data:image') && src.length > 10) {
                        if (src.startsWith('/')) {
                            src = new URL(url).origin + src;
                        }

                        // -----------------------------------------------------------------
                        // ABC - Optimizar calidad de imagen
                        // Elimina par谩metros de redimensionamiento para obtener original
                        // -----------------------------------------------------------------
                        if (domain === 'abc.es') {
                            // ABC usa URLs con patrones como abcblogs.abc.es/media/...?width=XXX
                            if (src.includes('?')) {
                                const urlObj = new URL(src);
                                // Eliminar par谩metros de tama帽o para obtener imagen original
                                urlObj.searchParams.delete('width');
                                urlObj.searchParams.delete('height');
                                urlObj.searchParams.delete('w');
                                urlObj.searchParams.delete('h');
                                src = urlObj.toString();
                            }
                            // Si tiene dimensiones en el nombre del archivo, reemplazar por original
                            src = src.replace(/_\d+x?\.(jpg|jpeg|png|webp)/gi, '.$1');
                            src = src.replace(/\/\d+x\d+\//g, '/');
                        }

                        // -----------------------------------------------------------------
                        // EL PAS - Optimizar calidad de imagen
                        // Usa resizer v2 con m谩xima calidad o imagen original
                        // -----------------------------------------------------------------
                        if (domain === 'elpais.com') {
                            // El Pa铆s usa URLs con patrones como imagenes.elpais.com/resizer/v2/...?width=XXX&height=XXX
                            // Eliminar par谩metros de redimensionamiento
                            if (src.includes('?')) {
                                const urlObj = new URL(src);
                                // Eliminar todos los par谩metros de tama帽o
                                urlObj.searchParams.delete('width');
                                urlObj.searchParams.delete('height');
                                urlObj.searchParams.delete('w');
                                urlObj.searchParams.delete('h');
                                // Agregar par谩metro de m谩xima calidad si es el resizer v2
                                if (src.includes('resizer/v2/')) {
                                    urlObj.searchParams.set('width', '2400');
                                    urlObj.searchParams.set('height', '1600');
                                }
                                src = urlObj.toString();
                            }
                            // Si tiene dimensiones en el nombre del archivo (ej: imagen_980x.jpg), reemplazar por original
                            src = src.replace(/_\d+x?\.(jpg|jpeg|png|webp)/gi, '_original.$1');
                            src = src.replace(/\/\d+x\d+\//g, '/original/');
                        }

                        // -----------------------------------------------------------------
                        // ELDIARIO.ES - Optimizar calidad de imagen
                        // Elimina par谩metros de redimensionamiento para obtener original
                        // -----------------------------------------------------------------
                        if (domain === 'eldiario.es') {
                            if (src.includes('?')) {
                                const urlObj = new URL(src);
                                // Eliminar todos los par谩metros de tama帽o
                                urlObj.searchParams.delete('width');
                                urlObj.searchParams.delete('height');
                                urlObj.searchParams.delete('w');
                                urlObj.searchParams.delete('h');
                                urlObj.searchParams.delete('resize');
                                urlObj.searchParams.delete('quality');
                                src = urlObj.toString();
                            }
                            // Eliminar sufijos de tama帽o en URLs de eldiario
                            src = src.replace(/_(small|medium|large|thumb)\.(jpg|jpeg|png|webp)/gi, '.$2');
                            src = src.replace(/_\d+x\d+\.(jpg|jpeg|png|webp)/gi, '.$1');
                        }

                        let caption = img.getAttribute('title') || '';
                        let captionAuthor = '';

                        // -----------------------------------------------------------------
                        // ABC - Extracci贸n de pie de foto
                        // Busca .voc-figcaption--text y .voc-figcaption--autho
                        // -----------------------------------------------------------------
                        if (domain === 'abc.es') {
                            let container = img.parentElement;
                            let attempts = 0;

                            // Subir hasta 5 niveles buscando el contenedor con figcaption
                            while (container && attempts < 5) {
                                const figcaption = container.querySelector('figcaption.voc-figcaption-container, .voc-figcaption-container');
                                if (figcaption) {
                                    const captionText = figcaption.querySelector('.voc-figcaption--text');
                                    const captionAuthorEl = figcaption.querySelector('.voc-figcaption--autho');

                                    if (captionText) {
                                        caption = this.cleanText(captionText.textContent);
                                    }
                                    if (captionAuthorEl) {
                                        captionAuthor = this.cleanText(captionAuthorEl.textContent);
                                    }
                                    break;
                                }
                                container = container.parentElement;
                                attempts++;
                            }
                        }

                        // -----------------------------------------------------------------
                        // EL PAS - Extracci贸n de pie de foto
                        // Busca figcaption con 2 spans: texto y autor
                        // -----------------------------------------------------------------
                        if (domain === 'elpais.com') {
                            // Buscar el contenedor padre que puede ser figure, div con clase a_m, etc.
                            let container = img.parentElement;
                            let attempts = 0;

                            // Subir hasta 5 niveles buscando el contenedor con figcaption
                            while (container && attempts < 5) {
                                const figcaption = container.querySelector('figcaption.a_m_p, .a_m_p, figcaption');
                                if (figcaption) {
                                    const spans = figcaption.querySelectorAll('span');
                                    if (spans.length >= 1) {
                                        caption = this.cleanText(spans[0].textContent);
                                    }
                                    if (spans.length >= 2) {
                                        captionAuthor = this.cleanText(spans[1].textContent);
                                    }
                                    break;
                                }
                                container = container.parentElement;
                                attempts++;
                            }
                        }

                        // -----------------------------------------------------------------
                        // EL MUNDO - Extracci贸n de pie de foto
                        // Busca .ue-c-article__media-caption con descripci贸n y autor
                        // -----------------------------------------------------------------
                        if (domain === 'elmundo.es') {
                            let container = img.parentElement;
                            let attempts = 0;

                            // Subir hasta 5 niveles buscando el contenedor con caption
                            while (container && attempts < 5) {
                                const captionContainer = container.querySelector('.ue-c-article__media-caption');
                                if (captionContainer) {
                                    const descriptionEl = captionContainer.querySelector('.ue-c-article__media-description');
                                    const authorEl = captionContainer.querySelector('.ue-c-article__media-author');
                                    const agencyEl = captionContainer.querySelector('.ue-c-article__media-agency');

                                    if (descriptionEl) {
                                        caption = this.cleanText(descriptionEl.textContent);
                                    }
                                    
                                    // Combinar autor y agencia si ambos existen
                                    let authorParts = [];
                                    if (authorEl) {
                                        authorParts.push(this.cleanText(authorEl.textContent));
                                    }
                                    if (agencyEl) {
                                        authorParts.push(this.cleanText(agencyEl.textContent));
                                    }
                                    if (authorParts.length > 0) {
                                        captionAuthor = authorParts.join(' / ');
                                    }
                                    break;
                                }
                                container = container.parentElement;
                                attempts++;
                            }
                        }

                        images.push({
                            src: src,
                            alt: img.alt || '',
                            caption: caption,
                            captionAuthor: captionAuthor
                        });
                    }
                });

                // -----------------------------------------------------------------
                // ELDIARIO.ES - Buscar im谩genes en elementos picture dentro de .post-item__body
                // -----------------------------------------------------------------
                if (domain === 'eldiario.es') {
                    const pictureElements = doc.querySelectorAll('.post-item__body picture');
                    pictureElements.forEach(picture => {
                        // Buscar en source elements primero
                        const sources = picture.querySelectorAll('source');
                        let src = null;

                        if (sources.length > 0) {
                            // Tomar el srcset del primer source
                            const firstSource = sources[0];
                            const srcset = firstSource.getAttribute('srcset');
                            if (srcset) {
                                src = srcset.split(',')[0].trim().split(' ')[0];
                            }
                        }

                        // Si no hay source, buscar img dentro del picture
                        if (!src) {
                            const img = picture.querySelector('img');
                            if (img) {
                                src = img.src || img.getAttribute('data-src') || img.getAttribute('srcset')?.split(',')[0].trim().split(' ')[0];
                            }
                        }

                        if (src && !src.includes('data:image') && src.length > 10) {
                            if (src.startsWith('/')) {
                                src = new URL(url).origin + src;
                            }

                            // Optimizar calidad de imagen para eldiario.es
                            if (src.includes('?')) {
                                const urlObj = new URL(src);
                                urlObj.searchParams.delete('width');
                                urlObj.searchParams.delete('height');
                                urlObj.searchParams.delete('w');
                                urlObj.searchParams.delete('h');
                                urlObj.searchParams.delete('resize');
                                urlObj.searchParams.delete('quality');
                                src = urlObj.toString();
                            }
                            src = src.replace(/_(small|medium|large|thumb)\.(jpg|jpeg|png|webp)/gi, '.$2');
                            src = src.replace(/_\d+x\d+\.(jpg|jpeg|png|webp)/gi, '.$1');

                            // Verificar que no est茅 ya en el array
                            const alreadyExists = images.some(existingImg => existingImg.src === src);
                            if (!alreadyExists) {
                                const img = picture.querySelector('img');
                                images.push({
                                    src: src,
                                    alt: img?.alt || '',
                                    caption: img?.getAttribute('title') || '',
                                    captionAuthor: ''
                                });
                            }
                        }
                    });
                }

                return images;
            }

            extractLinks(doc, domain) {
                // -----------------------------------------------------------------
                // EL PAS, ABC, ELDIARIO.ES - No extraer enlaces relacionados
                // Los enlaces de Twitter/X ahora se manejan en detectTwitterVideos()
                // -----------------------------------------------------------------
                if (domain === 'elpais.com' || domain === 'abc.es' || domain === 'eldiario.es') {
                    return [];
                }

                const links = [];
                const linkElements = doc.querySelectorAll('article a, .content a, .related a');
                linkElements.forEach(link => {
                    // Excluir enlaces que est谩n dentro de .c-header para evitar duplicados
                    const isInHeader = link.closest('.c-header');
                    if (!isInHeader && link.href && link.textContent.trim().length > 10) {
                        links.push({
                            url: link.href,
                            text: this.cleanText(link.textContent),
                            title: link.title || ''
                        });
                    }
                });
                return links;
            }

            // =====================================================================
            // EXTRACCIN DE CONTENIDO ADICIONAL POR PERIDICO
            // =====================================================================
            extractAdditionalContent(doc, domain, url) {
                let footerSummary = '';
                let subtitleLink = '';
                let subtitleLinkText = '';

                // -----------------------------------------------------------------
                // ELDIARIO.ES
                // Extrae resumen y enlace relacionado desde el footer del header
                // -----------------------------------------------------------------
                if (domain === 'eldiario.es') {
                    // Para eldiario.es NO extraer footerSummary porque suele ser texto del art铆culo
                    // Solo extraer enlaces relacionados si es necesario
                    const cHeader = doc.querySelector('.c-header');

                    if (cHeader) {
                        const footer = cHeader.querySelector('.news-header ul.footer');

                        if (footer) {
                            // Buscar enlaces con diferentes selectores: li.subtitle--hasAnchor h2 a o h2 a.footer-link
                            const subtitleLi = footer.querySelector('li.subtitle--hasAnchor h2 a, li h2 a.footer-link, h2 a.footer-link');
                            if (subtitleLi) {
                                subtitleLinkText = this.cleanText(subtitleLi.textContent);
                                subtitleLink = subtitleLi.getAttribute('href');

                                // Asegurar URL absoluta
                                if (subtitleLink && subtitleLink.startsWith('/')) {
                                    const urlObj = new URL(url);
                                    subtitleLink = urlObj.origin + subtitleLink;
                                }
                            }
                        }
                    }
                }

                // -----------------------------------------------------------------
                // ABC
                // Extrae el primer subt铆tulo (sin enlace) como resumen
                // y el segundo subt铆tulo con enlace clickable desde .voc-subtitle a
                // -----------------------------------------------------------------
                if (domain === 'abc.es') {
                    const infoContainer = doc.querySelector('.voc-info-container');

                    if (infoContainer) {
                        // Buscar todos los h2.voc-subtitle
                        const subtitles = infoContainer.querySelectorAll('h2.voc-subtitle');

                        if (subtitles.length > 0) {
                            // El primer subt铆tulo (normalmente sin enlace) se usa como resumen
                            const firstSubtitle = subtitles[0];
                            const firstLink = firstSubtitle.querySelector('a');
                            if (!firstLink) {
                                // Si el primer subt铆tulo NO tiene enlace, usarlo como resumen
                                footerSummary = this.cleanText(firstSubtitle.textContent);
                            }

                            // Buscar el subt铆tulo que tenga un enlace (normalmente el segundo)
                            subtitles.forEach(subtitle => {
                                const link = subtitle.querySelector('a');
                                if (link && link.href) {
                                    subtitleLinkText = this.cleanText(link.textContent);
                                    subtitleLink = link.href;

                                    // Asegurar URL absoluta
                                    if (subtitleLink && subtitleLink.startsWith('/')) {
                                        const urlObj = new URL(url);
                                        subtitleLink = urlObj.origin + subtitleLink;
                                    }
                                }
                            });
                        }
                    }
                }

                // -----------------------------------------------------------------
                // EL MUNDO
                // Extrae el standfirst como resumen desde:
                // .ue-l-article__header-content > .ue-c-article__standfirst > .ue-c-article__paragraph
                // -----------------------------------------------------------------
                if (domain === 'elmundo.es') {
                    const headerContent = doc.querySelector('.ue-l-article__header-content, .ue-c-article__header');
                    
                    if (headerContent) {
                        const standfirstContainer = headerContent.querySelector('.ue-c-article__standfirst');
                        
                        if (standfirstContainer) {
                            const paragraph = standfirstContainer.querySelector('.ue-c-article__paragraph');
                            
                            if (paragraph) {
                                footerSummary = this.cleanText(paragraph.textContent);
                            } else {
                                // Si no hay p谩rrafo espec铆fico, usar todo el texto del standfirst
                                footerSummary = this.cleanText(standfirstContainer.textContent);
                            }
                        }
                    }
                }

                return { footerSummary, subtitleLink, subtitleLinkText };
            }

            getCurrentFormattedDate(hoursOffset = 0) {
                const now = new Date();
                now.setHours(now.getHours() + hoursOffset);
                const day = String(now.getDate()).padStart(2, '0');
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const year = now.getFullYear();
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                return `${day}-${month}-${year} ${hours}:${minutes}`;
            }

            extractNewspaperFromUrl() {
                if (this.currentOriginalUrl) {
                    try {
                        const url = new URL(this.currentOriginalUrl);
                        let domain = url.hostname.replace('www.', '');
                        if (domain === 'eldiario.es') return 'elDiario.es';
                        if (domain === 'elpais.com') return 'El Pa铆s';
                        if (domain === 'elmundo.es') return 'El Mundo';
                        if (domain === 'abc.es') return 'ABC';
                        if (domain === '20minutos.es') return '20 Minutos';
                        return domain;
                    } catch (e) {
                        return 'Peri贸dico no disponible';
                    }
                }
                return 'Peri贸dico no disponible';
            }

            formatDateToDDMMYYYY(dateString) {
                if (!dateString) return '';
                const date = new Date(dateString);
                if (isNaN(date.getTime())) return '';
                const day = String(date.getDate()).padStart(2, '0');
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const year = date.getFullYear();
                const hours = String(date.getHours()).padStart(2, '0');
                const minutes = String(date.getMinutes()).padStart(2, '0');
                return `${day}-${month}-${year} ${hours}:${minutes}`;
            }

            displayModalContent(content) {
                // Actualizar el t铆tulo si el contenido tiene un t铆tulo extra铆do
                if (content.title && content.title.trim().length > 0) {
                    this.elements.modalTitle.textContent = content.title;
                }

                const modalBody = this.elements.modalBody;
                const domain = content.stats?.domain || '';
                let html = '<div class="modal-content">';

                // Secci贸n de informaci贸n
                html += '<div class="modal-section modal-info-section">';
                html += '<div class="modal-info-grid">';
                const newspaper = (content.stats && content.stats.domain) || this.extractNewspaperFromUrl() || 'Peri贸dico no disponible';
                html += `
                    <div class="modal-info-item">
                        <span class="modal-info-label">Peri贸dico:</span>
                        <span class="modal-info-value">${newspaper}</span>
                    </div>
                `;
                const author = content.author || 'Autor no disponible';
                html += `
                    <div class="modal-info-item">
                        <span class="modal-info-label">Autor:</span>
                        <span class="modal-info-value author-link">${author}</span>
                    </div>
                `;
                const publishDate = content.publishDate || this.getCurrentFormattedDate();
                html += `
                    <div class="modal-info-item">
                        <span class="modal-info-label">Fecha:</span>
                        <span class="modal-info-value">${publishDate}</span>
                    </div>
                `;
                const updateDate = content.updateDate || this.getCurrentFormattedDate(2);
                html += `
                    <div class="modal-info-item">
                        <span class="modal-info-label">Actualizado:</span>
                        <span class="modal-info-value">${updateDate}</span>
                    </div>
                `;
                html += '</div>';

                // Agregar imagen del autor si est谩 disponible
                if (content.authorImage) {
                    html += `<img src="${content.authorImage}" alt="${author}" class="modal-author-image" onerror="this.style.display='none'">`;
                }

                html += '</div>';

                // Secci贸n de resumen - priorizar seg煤n peri贸dico
                let summaryText = '';

                // Para elmundo.es, priorizar footerSummary (standfirst) sobre metaDescription
                if (domain === 'elmundo.es') {
                    if (content.footerSummary && content.footerSummary.trim().length > 20) {
                        summaryText = content.footerSummary;
                    } else if (content.metaDescription && content.metaDescription.trim().length > 20) {
                        summaryText = content.metaDescription;
                    } else if (this.currentSubtitle && this.currentSubtitle.trim().length > 10) {
                        summaryText = this.currentSubtitle;
                    }
                } else {
                    // Para otros peri贸dicos, orden original
                if (content.metaDescription && content.metaDescription.trim().length > 20) {
                    summaryText = content.metaDescription;
                } else if (content.footerSummary && content.footerSummary.trim().length > 20) {
                    summaryText = content.footerSummary;
                } else if (domain !== 'eldiario.es' && this.currentSubtitle && this.currentSubtitle.trim().length > 10) {
                    // Para eldiario.es NO usar currentSubtitle porque contiene texto del art铆culo
                    summaryText = this.currentSubtitle;
                    }
                }

                html += '<div class="modal-section modal-summary-section">';
                html += '<div class="modal-summary-label">Resumen:</div>';
                if (summaryText) {
                    html += `<div class="modal-summary-text">${summaryText}</div>`;
                } else {
                    html += '<div class="modal-summary-text">Resumen no disponible</div>';
                }
                if (content.subtitleLink && content.subtitleLinkText) {
                    // Enlace en el resumen - ahora se abre en la misma modal
                    html += `<div class="modal-summary-link">
                        <a href="javascript:void(0)" onclick="window.newsSearcher.loadModalContent('${content.subtitleLink}', '${content.subtitleLinkText.replace(/'/g, "\\'")}')">${content.subtitleLinkText}</a>
                    </div>`;
                }
                html += '</div>';

                // Videos (Dailymotion, Brightcove, El Pa铆s MP4, Bluesky, etc.)
                if (content.videos && content.videos.length > 0) {
                    // Si hay m煤ltiples videos, a帽adir t铆tulo de secci贸n
                    if (content.videos.length > 1) {
                        html += `<h4 style="font-size: 1.2em; color: #333; margin: 20px 0 10px 0;"> Videos (${content.videos.length})</h4>`;
                    }

                    // Mostrar TODOS los videos
                    content.videos.forEach((video, index) => {
                        html += '<div class="modal-video-player" style="margin-bottom: 20px;">';

                        // Si es video directo (MP4/HLS), usar <video> tag
                        if (video.isDirect) {
                            const isM3U8 = video.embedUrl.includes('.m3u8');
                            const videoId = `video-player-${index}`;
                            const posterAttr = video.thumbnail ? `poster="${video.thumbnail}"` : '';

                            html += `
                                <video
                                    id="${videoId}"
                                    controls
                                    ${posterAttr}
                                    style="width: 100%; height: 100%; background: #000;"
                                    data-src="${video.embedUrl}"
                                    data-is-hls="${isM3U8}">
                                    Tu navegador no soporta la reproducci贸n de este video.
                                </video>
                            `;
                        } else {
                            // Para videos embebidos (Dailymotion, Brightcove), usar iframe
                            html += `
                                <iframe
                                    src="${video.embedUrl}"
                                    allowfullscreen
                                    webkitallowfullscreen
                                    mozallowfullscreen
                                    allow="autoplay; fullscreen; encrypted-media; picture-in-picture">
                                </iframe>
                            `;
                        }

                        html += '</div>';
                    });
                }

                // Imagen - NO mostrar para eldiario.es porque las im谩genes ya est谩n integradas en el contenido del texto
                if (domain !== 'eldiario.es' && content.images && content.images.length > 0) {
                    const firstImage = content.images[0];
                    html += `<img src="${firstImage.src}" alt="${firstImage.alt}" class="modal-image" onerror="this.style.display='none'">`;

                    // Mostrar pie de foto
                    if (firstImage.caption || firstImage.captionAuthor || firstImage.alt) {
                        let captionHTML = '';

                        // Si tiene caption y captionAuthor (formato El Pa铆s)
                        if (firstImage.caption && firstImage.captionAuthor) {
                            captionHTML = `${firstImage.caption} <span style="font-style: normal; font-weight: 600;">${firstImage.captionAuthor}</span>`;
                        } else if (firstImage.caption) {
                            captionHTML = firstImage.caption;
                        } else {
                            captionHTML = firstImage.alt;
                        }

                        html += `<div class="modal-image-caption">${captionHTML}</div>`;
                    }
                }

                // Contenido principal
                if (content.text) {
                    // Mantener los enlaces originales del contenido del texto
                    html += `<div class="modal-text">${content.text}</div>`;
                } else {
                    html += '<p>No se pudo extraer el contenido completo del art铆culo.</p>';
                }

                html += '</div>';

                // Tweets relacionados - Embebidos con el sistema oficial de Twitter
                if (content.tweets && content.tweets.length > 0) {
                    html += '<div class="modal-tweets-section">';
                    html += `<h4 style="font-size: 1.2em; color: #1DA1F2; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="#1DA1F2">
                            <path d="M23.643 4.937c-.835.37-1.732.62-2.675.733.962-.576 1.7-1.49 2.048-2.578-.9.534-1.897.922-2.958 1.13-.85-.904-2.06-1.47-3.4-1.47-2.572 0-4.658 2.086-4.658 4.66 0 .364.042.718.12 1.06-3.873-.195-7.304-2.05-9.602-4.868-.4.69-.63 1.49-.63 2.342 0 1.616.823 3.043 2.072 3.878-.764-.025-1.482-.234-2.11-.583v.06c0 2.257 1.605 4.14 3.737 4.568-.392.106-.803.162-1.227.162-.3 0-.593-.028-.877-.082.593 1.85 2.313 3.198 4.352 3.234-1.595 1.25-3.604 1.995-5.786 1.995-.376 0-.747-.022-1.112-.065 2.062 1.323 4.51 2.093 7.14 2.093 8.57 0 13.255-7.098 13.255-13.254 0-.2-.005-.402-.014-.602.91-.658 1.7-1.477 2.323-2.41z"/>
                        </svg>
                         Tweets Relacionados (${content.tweets.length})
                    </h4>`;

                    content.tweets.forEach((tweet, index) => {
                        html += `
                            <div class="modal-tweet-card" style="
                                background: #fff;
                                border: 1px solid #e1e8ed;
                                border-radius: 16px;
                                padding: 16px;
                                margin-bottom: 16px;
                                box-shadow: 0 2px 8px rgba(0,0,0,0.05);
                                transition: var(--transition);
                            " onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)'" onmouseout="this.style.boxShadow='0 2px 8px rgba(0,0,0,0.05)'">
                                <div class="tweet-embed-container" style="
                                    width: 100%;
                                    min-height: 600px;
                                    border-radius: 12px;
                                    overflow: hidden;
                                    background: #f7f9fa;
                                ">
                                    <iframe
                                        src="${tweet.embedUrl}"
                                        style="width: 100%; min-height: 600px; border: none; border-radius: 12px;"
                                        allowfullscreen
                                        allow="autoplay; fullscreen; encrypted-media">
                                    </iframe>
                                </div>
                                <div style="margin-top: 12px; display: flex; align-items: center; justify-content: space-between;">
                                    <a href="${tweet.url}" target="_blank" style="
                                        color: #1DA1F2;
                                        text-decoration: none;
                                        font-size: 0.9em;
                                        font-weight: 500;
                                        display: inline-flex;
                                        align-items: center;
                                        gap: 4px;
                                        padding: 8px 12px;
                                        border-radius: 20px;
                                        transition: all 0.2s ease;
                                    " onmouseover="this.style.backgroundColor='#e8f5fe'" onmouseout="this.style.backgroundColor='transparent'">
                                         Ver en Twitter/X
                                    </a>
                                </div>
                            </div>
                        `;
                    });

                    html += '</div>';
                }

                modalBody.innerHTML = html;

                // Inicializar videos HLS despu茅s de insertar el HTML
                this.initializeHlsVideos();
            }

            initializeHlsVideos() {
                // Buscar todos los elementos video que necesitan HLS
                const hlsVideos = this.elements.modalBody.querySelectorAll('video[data-is-hls="true"]');

                hlsVideos.forEach(videoElement => {
                    const videoSrc = videoElement.getAttribute('data-src');
                    if (!videoSrc) return;

                    // Verificar si el navegador soporta HLS nativamente (Safari)
                    if (videoElement.canPlayType('application/x-mpegURL') || videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                        // Safari y navegadores compatibles
                        const source = document.createElement('source');
                        source.src = videoSrc;
                        source.type = 'application/x-mpegURL';
                        videoElement.appendChild(source);
                        videoElement.load();
                    } else {
                        // Otros navegadores - usar hls.js
                        if (typeof Hls === 'undefined') {
                            // Cargar hls.js si no est谩 disponible
                            const script = document.createElement('script');
                            script.src = 'https://cdn.jsdelivr.net/npm/hls.js@latest';
                            script.onload = () => {
                                this.loadHlsVideo(videoElement, videoSrc);
                            };
                            script.onerror = () => {
                                videoElement.innerHTML = `<div style="color: white; padding: 20px; text-align: center;">
                                    Error: No se pudo cargar el reproductor HLS.
                                    <br><a href="${videoSrc}" target="_blank" style="color: #667eea; text-decoration: underline;">Abrir video directamente</a>
                                </div>`;
                            };
                            document.head.appendChild(script);
                        } else {
                            this.loadHlsVideo(videoElement, videoSrc);
                        }
                    }
                });

                // Inicializar videos MP4 normales
                const mp4Videos = this.elements.modalBody.querySelectorAll('video[data-is-hls="false"]');
                mp4Videos.forEach(videoElement => {
                    const videoSrc = videoElement.getAttribute('data-src');
                    if (!videoSrc) return;

                    const source = document.createElement('source');
                    source.src = videoSrc;
                    source.type = 'video/mp4';
                    videoElement.appendChild(source);
                    videoElement.load();
                });
            }

            loadHlsVideo(videoElement, url) {
                if (Hls.isSupported()) {
                    const hls = new Hls({
                        enableWorker: true,
                        lowLatencyMode: false,
                        backBufferLength: 90
                    });

                    hls.loadSource(url);
                    hls.attachMedia(videoElement);

                    hls.on(Hls.Events.MANIFEST_PARSED, () => {
                        // Video listo para reproducir
                    });

                    hls.on(Hls.Events.ERROR, (event, data) => {
                        if (data.fatal) {
                            switch (data.type) {
                                case Hls.ErrorTypes.NETWORK_ERROR:
                                    console.error('Error de red al cargar el video');
                                    hls.startLoad();
                                    break;
                                case Hls.ErrorTypes.MEDIA_ERROR:
                                    console.error('Error de medios al reproducir el video');
                                    hls.recoverMediaError();
                                    break;
                                default:
                                    console.error('Error fatal al reproducir el video');
                                    hls.destroy();
                                    videoElement.innerHTML = `<div style="color: white; padding: 20px; text-align: center;">
                                        Error al reproducir el video.
                                        <br><a href="${url}" target="_blank" style="color: #667eea; text-decoration: underline;">Abrir video directamente</a>
                                    </div>`;
                                    break;
                            }
                        }
                    });

                    // Guardar referencia para poder destruir despu茅s
                    videoElement._hls = hls;
                } else {
                    videoElement.innerHTML = `<div style="color: white; padding: 20px; text-align: center;">
                        Tu navegador no soporta la reproducci贸n de este video.
                        <br><a href="${url}" target="_blank" style="color: #667eea; text-decoration: underline;">Abrir video directamente</a>
                    </div>`;
                }
            }
        }

        let newsSearcher;
        document.addEventListener('DOMContentLoaded', () => {
            newsSearcher = new NewsSearcher();
            window.newsSearcher = newsSearcher;
        });
    </script>
</body>
</html>

<!--

PERIDICOS LISTADOS
===================
ABC (abc.es)
Antena 3 (antena3.com)
ARA (es.ara.cat)
Cadena SER (cadenaser.com)
CATALUNYAPRESS.ES (catalunyapress.es)
Cope.es (cope.es)
CUADERNOSDESEGURIDAD.COM (cuadernosdeseguridad.com)
Deia.eus (deia.eus)
Dem贸crata (democrata.es)
DIARIODEMALLORCA.ES (diariodemallorca.es)
DIARIOSOCIALISTA.NET (diariosocialista.net)
DIARIOSUR.ES (diariosur.es)
Diariosigloxxi.com (diariosigloxxi.com)
EL CONFIDENCIAL (elconfidencial.com)
ELCONFIDENCIALDIGITAL.COM (elconfidencialdigital.com)
ELCORREO.COM (elcorreo.com)
elDEBATE (eldebate.com)
ELDIA.ES (eldia.es)
Eldiario.es (eldiario.es)
Eldiariodemadrid.es (eldiariodemadrid.es)
El Espa帽ol (elespanol.com)
ELGLOBALFARMA.COM (elglobalfarma.com)
El HuffPost (huffingtonpost.es)
El Independiente (elindependiente.com)
El Mundo (elmundo.es)
ELMUNDOTODAY.COM (elmundotoday.com)
ELNOTICIERODIGITAL.COM (elnoticierodigital.com)
El Pa铆s (elpais.com)
El Peri贸dico (elperiodico.com)
ELTELEVISERO.HUFFINGTONPOST.ES (eltelevisero.huffingtonpost.es)
Epe.es (epe.es)
ESCUDODIGITAL.COM (escudodigital.com)
ESTRELLADIGITAL.ES (estrelladigital.es)
EUROCARNE.COM (eurocarne.com)
Europa Press (europapress.es)
GACETAMEDICA.COM (gacetamedica.com)
Gacetinmadrid.com (gacetinmadrid.com)
HOYARAGON.ES (hoyaragon.es)
INFOBAE.COM (infobae.com)
INFOLIBRE (infolibre.es)
INFOPLAY.INFO (infoplay.info)
INSST.ES (insst.es)
INTEREMPRESAS.NET (interempresas.net)
Joan Seguidor (joanseguidor.com)
LAMONCLOA.GOB.ES (lamoncloa.gob.es)
LAOPINIONDEZAMORA.ES (laopiniondezamora.es)
LA RAZN (larazon.es)
laSexta (lasexta.com)
La Vanguardia (lavanguardia.com)
LIBERTAD DIGITAL (libertaddigital.com)
MASPALOMAS24H.COM (maspalomas24h.com)
Naiz (naiz.eus)
Newtral.es (newtral.es)
NOTEOLVIDESDELSAHARAOCCIDENTAL.ORG (noteolvidesdelsaharaoccidental.org)
NUEVATRIBUNA.ES (nuevatribuna.es)
OKDIARIO (okdiario.com)
ONDACERO.ES (ondacero.es)
PRESSDIGITAL.ES (pressdigital.es)
P煤blico (publico.es)
PUERTOLLANO.ES (puertollano.es)
Radiopopular.com (radiopopular.com)
RTVE (rtve.es)
SALAMANCARTVALDIA.ES (salamancartvaldia.es)
Telecinco (telecinco.es)
Telemadrid.es (telemadrid.es)
Teleprensa (teleprensa.com)
VALENCIAPLAZA.COM (valenciaplaza.com)

TOTAL: 67 peri贸dicos

PERIDICOS CONFIGURADOS (NO TOCAR !!)
====================================
Eldiario.es (eldiario.es)
El Pa铆s (elpais.com)
ABC (abc.es)
El Mundo (elmundo.es)


OJO!! No contemplar MSN porque es un agregador de noticias y no tiene contenido propio.

NDICE DE CONFIGURACIONES POR PERIDICO
========================================
A continuaci贸n se indica d贸nde encontrar las configuraciones espec铆ficas
de cada peri贸dico para facilitar las modificaciones futuras:

1. CONFIGURACIN DE SELECTORES CSS (l铆nea 1717)
   - Secci贸n principal: this.siteConfigs
   - Incluye selectores para: title, content, author, images, date, exclude
   - Peri贸dicos: eldiario.es, elpais.com, elmundo.es, abc.es

2. EXTRACCIN DE AUTOR (l铆nea 3522)
   - Funci贸n: extractAuthor()
   - L贸gica espec铆fica para: eldiario.es, elpais.com
   - Peri贸dicos gen茅ricos usan config.author

3. EXTRACCIN DE IMAGEN DEL AUTOR (l铆nea 3772)
   - Funci贸n: extractAuthorImage()
   - L贸gica espec铆fica para: abc.es, elpais.com, eldiario.es, elmundo.es
   - elmundo.es: extrae desde JSON-LD schema.org ({"@type":"Person","image":"..."})

4. EXTRACCIN DE CONTENIDO Y FECHAS (l铆nea 3812)
   - Funci贸n: extractContent()
   - Fechas de publicaci贸n/actualizaci贸n
   - L贸gica espec铆fica para: eldiario.es, elpais.com, abc.es, elmundo.es
   - elmundo.es: extrae desde .ue-c-article__bar-footer > .ue-c-article__publishdate > time > span
   - Eliminaci贸n de elementos espec铆ficos por peri贸dico
   - Selectores de contenido espec铆ficos

5. EXTRACCIN DE IMGENES (l铆nea 4248)
   - Funci贸n: extractImages()
   - Optimizaci贸n de calidad de imagen para: abc.es, elpais.com, eldiario.es
   - Extracci贸n de pies de foto para: abc.es, elpais.com, elmundo.es
   - elmundo.es: extrae descripci贸n (.ue-c-article__media-description) y autor/agencia

6. EXTRACCIN DE CONTENIDO ADICIONAL (l铆nea 4581)
   - Funci贸n: extractAdditionalContent()
   - L贸gica espec铆fica para: eldiario.es (enlaces relacionados), abc.es (subt铆tulos), elmundo.es (standfirst)
   - elmundo.es: extrae el standfirst (.ue-c-article__standfirst) que aparece en el resumen del modal

7. DETECCIN DE VIDEOS (l铆neas 2945-3475)
   - detectDailymotionVideos() - l铆nea 2945
     路 Detecta 5 patrones: data-video-id, iframe src, URL directa, data-src, player ID
     路 Patr贸n 5 espec铆fico para elmundo.es: id="player_..._X" donde X es el video ID
     路 Compatible con todos los peri贸dicos
   - detectBlueskyVideos() - l铆nea 3111 - detecta posts de Bluesky embebidos
   - detectBrightcoveVideos() - l铆nea 3457 - espec铆fico para abc.es
   - fetchBlueskyVideos() - extrae videos usando la API p煤blica de Bluesky

8. DETECCIN Y CORRECCIN DE ENCODING (l铆neas 2787-2872)
   - loadFullContent() - l铆nea 2787 - detecta autom谩ticamente la codificaci贸n correcta
   - fixEncoding() - l铆nea 2844 - corrige caracteres mal codificados (锟)
   - Funciona para todos los peri贸dicos (elmundo.es, etc.)
   - Lee respuestas como arrayBuffer y detecta charset declarado en HTML
   - Intenta UTF-8 primero, luego Windows-1252/ISO-8859-1 si es necesario

CMO AGREGAR UN NUEVO PERIDICO:
=================================
1. Agregar configuraci贸n en this.siteConfigs (l铆nea 1717)
2. Si es necesario, agregar l贸gica espec铆fica en:
   - extractAuthor() (l铆nea 3522) para autor
   - extractAuthorImage() (l铆nea 3556) para imagen del autor
   - extractContent() (l铆nea 3682) para fechas y formato de contenido
   - extractImages() (l铆nea 4118) para optimizaci贸n de im谩genes y pies de foto
   - extractAdditionalContent() (l铆nea 4414) para contenido adicional espec铆fico
3. Agregar eliminaci贸n de elementos espec铆ficos si es necesario
4. Probar con varias noticias del peri贸dico

 -->